<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Bruno Opsenica's Blog]]></title><description><![CDATA[A blog about learning 3D programming]]></description><link>https://bruop.github.com/</link><generator>RSS for Node</generator><lastBuildDate>Fri, 19 Apr 2019 15:26:28 GMT</lastBuildDate><item><title><![CDATA[Tone Mapping]]></title><description><![CDATA[Introduction In  the last post , I explained how to can calculate the exposure of an HDR image, like the ones produced by in physically…]]></description><link>https://bruop.github.com//tonemapping/</link><guid isPermaLink="false">https://bruop.github.com//tonemapping/</guid><pubDate>Fri, 19 Apr 2019 15:00:14 GMT</pubDate><content:encoded>&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;In &lt;a href=&quot;/blog/exposure&quot;&gt;the last post&lt;/a&gt;, I explained how to can calculate the exposure of an HDR image, like the ones produced by in physically based rendering. This exposure allows us to basically “calibrate” our image such that we scale the luminance values to a range where we can now apply a tone curve. In case you didn’t read the post, here’s the diagram explaining the workflow:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ecff7f0a2babbe9a75e20c835f538967/1d510/tonemapping_pipeline.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 27.67762460233298%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABg0lEQVQY02NggALl7ouMDOm7WBmQAEvJPkGGtB3yDBEb5RjCNkozZO9SZMjcxY1QEcTIVb4fRQ/D////xd6/eSnM4NnNZN6+m+P+46eiX37/lzh7/a4IRP4V5///f0X+//8BxA+Zt+7dx3L9/hPxhy/fSZy7dkuAIWIFq3r7RjaFqcfEpaeeEGN49uzZr9evX98CaT5x7aH8u3dvnwH5/z9++HACJPby5auOz1++/H///v3fx4+fet27e0/n06dPX75+/fr/1es3K0BqVCcfttBcdvuP9sp7XxgePXr0/927dx8Yghk4V1zYYfDy5Yu/QEtABtwFqmV8+vrZvJ8/fv7/8ePH/wcvHkTuu7LP7j8UvH//dg/IQO/Z67yMdn/9b7nrw3+GP3/+3P369ctBkObtZy7JAdmn//79++jLly8bQYrff3hfCVTz+NevX/efPX/mfO3mNU2g4TdAat5/+DAVpEZ/2n5j9WV37qqvuH8NHpYcVU+YGDyWMjOQCmpvoEQKAAji42NUwhc/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Tone mapping pipeline&quot;
        title=&quot;&quot;
        src=&quot;/static/ecff7f0a2babbe9a75e20c835f538967/44427/tonemapping_pipeline.png&quot;
        srcset=&quot;/static/ecff7f0a2babbe9a75e20c835f538967/d7a70/tonemapping_pipeline.png 180w,
/static/ecff7f0a2babbe9a75e20c835f538967/0b140/tonemapping_pipeline.png 360w,
/static/ecff7f0a2babbe9a75e20c835f538967/44427/tonemapping_pipeline.png 720w,
/static/ecff7f0a2babbe9a75e20c835f538967/1d510/tonemapping_pipeline.png 943w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;This post will focus on the third box, Tone mapping operators. A tone mapping operator is a curve/function that takes a luminance value (or an individual color channel) as input and spits out a value between [0, 1], which is what our display expects. Additionally, it is meant to produce an image that better invokes the reality. This is totally subjective, and there is no strictly correct choices here since on an Standard Dynamic Range (SDR) display we &lt;em&gt;cannot actually reproduce the reality&lt;/em&gt;, so we have to settle for creating one that provides roughly the same impression on the viewer. There are simply too many limitations present to achieve perfect reproduction (and it’s not even clear that we’d want that), but we can do a much better job than the naive approach of clamping!&lt;/p&gt;
&lt;p&gt;There are &lt;a href=&quot;https://www.shadertoy.com/view/WdjSW3&quot;&gt;many different curves&lt;/a&gt; that fulfill this function, but most have the following features:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A “shoulder” which is meant to map larger luminance values to values approaching 1, but this convergence is typically asymptotic.&lt;/li&gt;
&lt;li&gt;A “foot”, which is mean to control how the lower ranges of luminance are displayed. The foot is not as common or necessary as the shoulder, but it can help prevent darker portions of the image from being too dark.&lt;/li&gt;
&lt;li&gt;A linear or mostly linear portion, controls how your “mid tones” scale.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The simplest example are probably the &lt;a href=&quot;http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf&quot;&gt;Reinhard curves&lt;/a&gt; (Equations 3, 4).&lt;/p&gt;
&lt;h2&gt;Reinhard Curves&lt;/h2&gt;
&lt;p&gt;There are basically two Reinhard curves that people have used over the years. The first, simpler one is as follows:&lt;/p&gt;
&lt;span class=&quot;katex-display&quot;&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;msup&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo mathvariant=&quot;normal&quot;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo mathvariant=&quot;normal&quot;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_d = \frac{L^\prime}{1+L^\prime}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.1982220000000003em;vertical-align:-0.7693300000000001em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.428892em;&quot;&gt;&lt;span style=&quot;top:-2.314em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.6778919999999999em;&quot;&gt;&lt;span style=&quot;top:-2.9890000000000003em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.751892em;&quot;&gt;&lt;span style=&quot;top:-3.063em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.7693300000000001em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;p&gt;Where &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_d&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; is the final display luminance, and &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo mathvariant=&quot;normal&quot;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L^\prime&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.751892em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.751892em;&quot;&gt;&lt;span style=&quot;top:-3.063em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; is the &lt;a href=&quot;/exposure&quot;&gt;exposure adjusted input luminance&lt;/a&gt;:&lt;/p&gt;
&lt;span class=&quot;katex-display&quot;&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo mathvariant=&quot;normal&quot;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;in&lt;/mtext&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mn&gt;9.6&lt;/mn&gt;&lt;mo&gt;∗&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;avg&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L^\prime = \frac{L_{\text{in}}}{9.6 * L_{\text{avg}}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.801892em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.801892em;&quot;&gt;&lt;span style=&quot;top:-3.113em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.332438em;vertical-align:-0.972108em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.36033em;&quot;&gt;&lt;span style=&quot;top:-2.314em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;∗&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15139200000000003em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;avg&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.286108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.31750199999999995em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;in&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.972108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;p&gt;This is a really easy way to effectively prevent any luminance from exceeding the max value of 1.0, while scaling lower luminance values (where &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L &amp;lt;&amp;lt; 1&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.72243em;vertical-align:-0.0391em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;&amp;lt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.5782em;vertical-align:-0.0391em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.64444em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;) linearly (e.g &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_d = L&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;). However, this is going to prevent you from ever actually having a luminance value of 1.0, so there is a second, modified equation that allows us a bit more control over higher luminance values:&lt;/p&gt;
&lt;span class=&quot;katex-display&quot;&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo mathvariant=&quot;normal&quot;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;∗&lt;/mo&gt;&lt;mrow&gt;&lt;mo fence=&quot;true&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mfrac&gt;&lt;msup&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo mathvariant=&quot;normal&quot;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;msubsup&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;white&lt;/mtext&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/mfrac&gt;&lt;mo fence=&quot;true&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo mathvariant=&quot;normal&quot;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_d = \frac{L^\prime * \left( 1 + \frac{L^\prime}{L_\text{white}^{2}} \right)}{1+L^\prime}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.95935em;vertical-align:-0.7693300000000001em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:2.19002em;&quot;&gt;&lt;span style=&quot;top:-2.464em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.6778919999999999em;&quot;&gt;&lt;span style=&quot;top:-2.9890000000000003em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.38em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-4.1900200000000005em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.751892em;&quot;&gt;&lt;span style=&quot;top:-3.063em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;∗&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;minner&quot;&gt;&lt;span class=&quot;mopen delimcenter&quot; style=&quot;top:0em;&quot;&gt;&lt;span class=&quot;delimsizing size2&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.97348em;&quot;&gt;&lt;span style=&quot;top:-2.62642em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.8051142857142858em;&quot;&gt;&lt;span style=&quot;top:-2.1527714285714286em;margin-left:0em;margin-right:0.07142857142857144em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.5em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size3 size1 mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;white&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-2.8448em;margin-right:0.07142857142857144em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.5em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size3 size1 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.3472285714285714em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.394em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.8278285714285715em;&quot;&gt;&lt;span style=&quot;top:-2.931em;margin-right:0.07142857142857144em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.5em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size3 size1 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.6166399999999999em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose delimcenter&quot; style=&quot;top:0em;&quot;&gt;&lt;span class=&quot;delimsizing size2&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.7693300000000001em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;p&gt;Where &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;white&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{\text{white}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;white&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; is a user-controlled variable that allows us to set the saturation point. You can see how changing &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;white&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{\text{white}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;white&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; changes the function using &lt;a href=&quot;https://www.desmos.com/calculator/h8lpdqtlxi&quot;&gt;this desmos graph&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To apply these tone operators to our image, we can write a simple fragment shader that takes our HDR PBR output, the average luminosity (store in a 1x1 texture) and writes the output to the backbufffer:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;glsl&quot;&gt;&lt;pre class=&quot;language-glsl&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;$&lt;span class=&quot;token keyword&quot;&gt;input&lt;/span&gt; v_texcoord0

&lt;span class=&quot;token preprocessor builtin&quot;&gt;#&lt;/span&gt;include &lt;span class=&quot;token string&quot;&gt;&quot;common.sh&quot;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;SAMPLER2D&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_texColor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// This is the output from the compute shaders in the last post&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;SAMPLER2D&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_texAvgLum&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// This will store whatever params you need for the curve&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// (whitePoint in this case)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;uniform&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;vec4&lt;/span&gt; u_params&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;vec3&lt;/span&gt; rgb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;texture2D&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_texColor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v_texcoord0&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;rgb&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; avgLum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;texture2D&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_texAvgLum&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v_texcoord0&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;vec3&lt;/span&gt; Yxy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertRGB2Yxy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rgb&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; whitePoint   &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; u_tonemap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; lp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Yxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9.6&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; avgLum &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Replace this line with other tone mapping functions&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Here we applying the curve to the luminance exclusively&lt;/span&gt;
  Yxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reinhard2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; whitePoint&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  rgb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertYxy2RGB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Yxy&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  gl_FragColor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toGamma&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;vec4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rgb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The code is fairly simple, and the process is simple:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Transform the RGB value into CIE xyY color space, where the Y is the luminosity&lt;/li&gt;
&lt;li&gt;Adjust for exposure&lt;/li&gt;
&lt;li&gt;Scale the luminance (and only the luminance) using the tone curve&lt;/li&gt;
&lt;li&gt;Perform the reverse transformation (xyY -&gt; RGB)&lt;/li&gt;
&lt;li&gt;Apply gamma correction and write the results to the backbuffer&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;For the individual curve codes, &lt;code class=&quot;language-text&quot;&gt;reinhard(Y)&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;reinhard2(Y, whitePoint)&lt;/code&gt;, check this &lt;a href=&quot;https://www.shadertoy.com/view/WdjSW3&quot;&gt;shader toy&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;With Reinhard curves, you don’t want to apply the operator to the RGB channels individually, as this will produce highly desaturated blacks. Feel free to try it though and see how output compares.&lt;/p&gt;
&lt;p&gt;For reference, here’s three images that show the (gamma corrected) results using three different curves: linear (e.g. no operator applied), simple Reinhard and the modified Reinhard:&lt;/p&gt;
&lt;figure class=&quot;gatsbyRemarkImagesGrid&quot;&gt;&lt;div class=&quot;gatsbyRemarkImagesGrid-grid&quot; style=&quot;
            grid-template-columns: repeat(auto-fill, minmax(31%, 1fr));
          &quot;&gt;

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ca32698aa9da16df7081cdcd32880c24/ae828/linear.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADFElEQVQozx2SXUybVRyHe2sUBYGKdFvdXBmja4Hy0i/aFdYvaF+6voWWMqCUlhZqy8qgY7A1VZTZOfBjOGQbIzNxKnHT6J03aubilZropSZeGE2MF7vwxiVG83j04uSXnPzO83/OyVFtn89xY6XA7oUS9+5c4++Hv/PXnw/48asP+fjyEq8u5theTLO7PM3e87MiU7y1mOCqWBdno5TGZc6nwpQSg+SjHlQ3y9NsVebYPJfi03cu8eDX73n4x2/8/N1nfPlGmZfncuysTrG9NMpuaYLNWYX1rEJVwFaSIQojnv9BWaWXmUgfqheyJ8lPisJ8jI92qsA//PT5+9zdeon3rq6xMh3l3Z08l88OcWUuxMbMIMuTPopjHnITDjKjdk7HfRTifnIxL6pCvI/n4h5KyQCXzia5/8Un3KwucX2txJ1bGyykgmxUJilOy5TF0P/6Z6bcLGT8zCadnBq2MixbGQ/3IPuNqIojQlUAZ0ZEIT5AzGtGcUtMxG1kUl0s5IIUMwNMxCxUFtLElS4GgkcZiphQIu145DYcHh19bh09fQdQZRQH4YAFeUAiET1OdszPm+sJ4hNmxk5ZWT2XZXW5wHi0FyXQQThswCcfFoe1OH3P0OM9yIngIZzeA9i8zajSUzbkSCfzZ3qZL7p4saJQWuzHKyZ7fHry6RBRRUIOtJMRbxaUW7C79uHyarH1NiM51Lh8GvyyFrNLjWpkXJikbVzbSrF3O89rF92kEwbcvoPCQoPd3kyg/zDdZg0eRytjIR0OZxP2E0/T5Wik09YgskHkkyLrUS2Xvbx9OymuFmHveo4fvqlwpTpMqP8IDmsjXreewswQhbRCLOhC0muxSE1IlgaMpjoMXbUcMz+B3lyDyVkr/uGmm7WqzOn8ceKDh7h7K8YrF9yMhoz0SE/RbajF2qEWqcHY2kSbTkN7+z5hqBFGagGpp9MuoN2PobfUofr6XprX16Oc7NeRCDdy/wM/v3ybpFzswGraj+FILfpnH6FV+yjGljo6jqrFfgsmaT/GbjVt0uMCVoOxs0aY1vMvEnjCXkZy590AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Linear tone mapping&quot;
        title=&quot;&quot;
        src=&quot;/static/ca32698aa9da16df7081cdcd32880c24/44427/linear.png&quot;
        srcset=&quot;/static/ca32698aa9da16df7081cdcd32880c24/d7a70/linear.png 180w,
/static/ca32698aa9da16df7081cdcd32880c24/0b140/linear.png 360w,
/static/ca32698aa9da16df7081cdcd32880c24/44427/linear.png 720w,
/static/ca32698aa9da16df7081cdcd32880c24/fff27/linear.png 1080w,
/static/ca32698aa9da16df7081cdcd32880c24/ae828/linear.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5ee6b90a6aa4d32807d902b8d12810fa/ae828/reinhard1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADB0lEQVQozxWR3U+bZRjG31PjNsdY2VZkSBgbpaUrvP1uaWn7Qr9bPtrS0kI/6MdaoE3BbUxgLJARQOoWN2M0U7OZ6DIT46k7WUw8NdETzzXxaIf+AT8fD+5c95Nc9+++nueRjlt5TpslPmk1eNHZ5a/ffuTtn695/fyYZ9urHDQKnDSyPFrP8vnmstCMOKc4ErVTjNNcCLCZC9PMBKjNepAetbMcbazwcH2RZ8eb/P7ma/7+4xVvXn3Gy70WO5UiJxsLnKzN8biR5KgYZj8f4b6AbWRD1OY9VAWoFHOxEnch3c0HqWQi7NRm+OrjLf59+w+/fPuELw7v8OXRR7SXZ+gc5NithzisBNgv+GkveqkveCinbRSSFuoJHzVR5TkvUi0xQTnhoZmdZnctxU/fd3i8XaFzr843Tx6wtuRn//YC5cwUrfIMVeFfzbpZzfsoZe2kZs3Mhiykw2ZCig6pMT9BSQBL8z5WEtMkFCtxr5H0vIV8zkBdDFZzCsmYTLuaJRE14A8OE48ZiMX1eIMaHN4h3J5r2N19SMWojVjARMgvszjnFFfwsL8VI5GRSSZMbNxapl2rkIw6ifpHiUZGUIKD2Cf7cSj92JUPmAwM4PD1YfVdQcotmgnE9FSrVmpVG7dbCvWaCyWkYdKnoZjxE4+MEZgeJZ+y4A8MYnP1MuG7itWlxujoEb1aLOnD5FIhzaeNpJaMPHwww9PTJHsf2lhKj+CdGsDmVmOxXEHxDSCb1Lit10mKdE7nZayTl5EdKgzWbsYdFzHYLgjtRlpvOjk9ibJ5S+HTvTg/f5fj4K6XyPQQDosKj1tDIRcVSSNEp5wYtVcxywJmvoh+vAudfB6t6RwjpjOMOd9DOt61cmfLSaUgM+fv5+mhwvaahVRYi914CaPuPJabPULV6G9cYuRaL3p9LzaPWiRSCUi3SPc/9AxacxfSD8/D3L/nIyIeNxVS8bJj49cXQfGjOqzjfehuCPPgOwz3v4v+ehc3h3uwjA0xJr+P3tiDRj6H1niWUcNZdKYL/Afpj68Q02/mqAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Simple Reinhard&quot;
        title=&quot;&quot;
        src=&quot;/static/5ee6b90a6aa4d32807d902b8d12810fa/44427/reinhard1.png&quot;
        srcset=&quot;/static/5ee6b90a6aa4d32807d902b8d12810fa/d7a70/reinhard1.png 180w,
/static/5ee6b90a6aa4d32807d902b8d12810fa/0b140/reinhard1.png 360w,
/static/5ee6b90a6aa4d32807d902b8d12810fa/44427/reinhard1.png 720w,
/static/5ee6b90a6aa4d32807d902b8d12810fa/fff27/reinhard1.png 1080w,
/static/5ee6b90a6aa4d32807d902b8d12810fa/ae828/reinhard1.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4b6ce875b7468281c16fa9f05e3278e5/ae828/reinhard2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADCUlEQVQozx2SW0zbVRzH/69GmUMGYhHrHGxAS2npv/fS0hu90Bvrjd6gpaylFMtl3dzCKiyT4QbiavYAcTHGmIxEkyXzzTdioonGZx9MfPFFn4xvvpiPxz2cfB/OOZ/v55dzpIONEkcbyzzabPC0s8Ofv57x9+8/c3Z6xGftNT5olDlsFOg0C5y0FkXmOGhkeCDWnaU4zfkArWKY9VyQ2lUX0sdbBR62ltlv5vn8oxv88uMz/vjtO354/ilf7a7Tri5x2Mpy+O5VOo00D8ph7pUi7AjY9XyIlYTrBWgp5qAScyK9txiimovQrsX5ovM+//7zF9+fPubJh7d5cnCHrYU4nf1Fdhqz7FeD3CsH2Mq5Wc24WM5aKKfN1FMeakkv1xJupJWkg2spN838DLvrWb795pjHO3U67SZfHu+xVvSzdytHVexvVufERQeNgpO1kodKwUpmzshcyEQ2bCLkUyOtJoRqykVFNFSSMyTcJmJumWzSRKmgpVH2USv6yMRlWvUiqagOf3CEWExLNKbBHRrF5h7G6RrC6hxEKketRAMGQgE9uYRdjOBmb3uOZFZPOmXgxlqJ66s10rEpov5xIuExvMFLWKeV2LxKrN63mQ5exOYZxOxRIBXzRgKxCep1Kys1K7e2/DTqTryi2eUdpZIPEo/oCArYYsZMIDiExTHAlEeJ2aFAtvUx5VWIkkEMjj6kZFYms2Dg4V6C4848d29aKc6P4fZdxOJUYDa/gc/7DrJxgGnLZVLCzm7vx+LqR2/rRWvuYdJ2Aa3lNZE9SBubDh4dxbi5OsPJ/SRnz8rc3/YRnhnGburF5RSWC1HxABFifjuy6i2MegEzXkAz2Y1afx6V4Rxjhi509leRDnet3N52UivLJANKTg5maDctpGdVWPWvI6vPY5roE6lAc6WfsaEBNJoBYah4YThp7xF2/0NfQWXqRnr+NMLdtp+wGHF+tpevP7Hx02lYfBE15slBxq+Iw5deYkT5MprL3UyM9GHSDaPTv4lG7mVUfw6V3MW4tgu1oYf/AMwDsqbpC1ThAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Modified Reinhard&quot;
        title=&quot;&quot;
        src=&quot;/static/4b6ce875b7468281c16fa9f05e3278e5/44427/reinhard2.png&quot;
        srcset=&quot;/static/4b6ce875b7468281c16fa9f05e3278e5/d7a70/reinhard2.png 180w,
/static/4b6ce875b7468281c16fa9f05e3278e5/0b140/reinhard2.png 360w,
/static/4b6ce875b7468281c16fa9f05e3278e5/44427/reinhard2.png 720w,
/static/4b6ce875b7468281c16fa9f05e3278e5/fff27/reinhard2.png 1080w,
/static/4b6ce875b7468281c16fa9f05e3278e5/ae828/reinhard2.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;/div&gt;&lt;figcaption class=&quot;gatsbyRemarkImagesGrid-figcaption&quot;&gt;From left to right: Linear, Simple Reinhard, Modified Reinhard&lt;/figcaption&gt;&lt;/figure&gt;
&lt;p&gt;It’s worth calling out the problems with the linear example first in order to clarify what we’re trying to solve for. Look at the highlights being reflected on the bunny — they are reflections of the sky above, which is actually a very bright blue. However, the high luminance of the sky causes it to just appear white on the bunny. Similarly, all the windows are blown out and appear uniformly white, while the flare from the sun is enormous. On the other end of the scale, there is actually very little black in the image — most things that appear black here are actually gray. This means we’re not using the entirety of our range from [0, 1] despite there being highly occluded scenery like the area underneath the rabbit, the interior of the foliage, etc. These are some of the more subtle problems we want to solve with our tone mapping.&lt;/p&gt;
&lt;p&gt;Meanwhile, the reinhard curves address some, but not all, of these problems. The simple Reinhard really removes white from most of our highlights on the bunny, showing a deep blue sky instead. However, the leaves on the left are now a pale green, which doesn’t give the impression that they are actually reflecting a lot of light (which is actually the reality). More noticeably, the sun’s flare is now almost completely white, but we can actually see a tiny patch of the sky in the top right of that window, whereas in the linear example, the flare is probably too large but we don’t get any unexpected patches of color.&lt;/p&gt;
&lt;p&gt;The adjusted reinhard has much better highlights, due to our choice of &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;white&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{\text{white}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;white&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;. If our value is too low, then we’ll get more and more blown out features like with the linear version, but as &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;white&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{\text{white}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;white&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; grows larger, we’ll end up with something very similar to the simple Reinhard. The following three images depict&lt;/p&gt;
&lt;figure class=&quot;gatsbyRemarkImagesGrid&quot;&gt;&lt;div class=&quot;gatsbyRemarkImagesGrid-grid&quot; style=&quot;
            grid-template-columns: repeat(auto-fill, minmax(31%, 1fr));
          &quot;&gt;

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0538b9a3fb3721c588173236e04e00bc/92da1/white15.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 58.65834633385335%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADXUlEQVQozxXRW0ybBRjG8d5qYgJTDtkyoBVkrGuhME4tB2lL13M/KIwe0nYtXTkUSqFshVHKmTLQdLCFjW10sg1jwEQTEZbIhXGJdybGxHhh4oVGk12auBjjxd/Pi/f29z7P+0oS4T7WUjc5Pn7BzodrjHqs+Pu6GPI7GfI5WUunuHNrglQ0QCzkITkYID3kY2kiwtJIAK9gQd/egr5Nja6tGUl3Rx2OzhYmE+MMBP10NiiIBbzMxiLsrCT48WSfn0+e8nI/y8FGksMPZji+PcHp1gwv7yQwmZxIq7WUy5uorKhA0tph5nJHN5VKNW8XFCGTybibHCY3m+TrT+7zz+vf+fuvP/j1dI/PM7fYmRnn+Ww/B8sjfLbQT2urAWm9g/IaHRcqK5GoTUZUdoHLgkDJRTnvnivg07UxPs5Mcvp8ndevfuLVL9/xw1GOg5UpHiyP8eV+lAc33RykAjQrysnLy6e4qJCCd84gsWlVWA1qrok1g6EwsXCQu5NuFuMevthdgX//5PuDLLlsmo2pEMvjXnJbQTGph9xqD40qKfl5eRQVnqGwQATHr7aRDunIJh1sL7rZy3iZj5hJDThYv+Fj794S6cFedrOLPFqfJuxSsxAz82jZTjqh5YLsPG++8ZaYMk+E85HE3Tq20w421+1kN2ycfNTDSvgKYY+ReFAg3KtnwG/mul/LXMzF9KSe1fl25ucaSSbVeL1KNG1lNKhLqW0qQZKZMXL8JMLthED8upGRsIFoqINAUMNgpJVk3EvqRpA+Z4O45H0yKzb2nrjw+evo7pPjDyrwXFPi8lVj7RKfsr3l4OE9J/2RelyeOkZHdISj7SysCmxuujBbLtKhl2K1yel1KOkSZMwlNWyuaVmYqsFqL0FnkqI3yzBYy5H0eGvocV/C2adkespM7vEoSxkjO/c9HO5GuepSYbEpsVlq6XY0YtGVYWorZ9TXyFZaz8JYLXZzCQZxOu2l/4NKEVPgdCqJDrZzejTE0WEPi0sOhgNyHm92MxwyMC1Wj4ZNNCjOUltVhqqqlHqFDKNGiVVbgU5bjN4q3tDSW4UgVCLYKkiNafjt236+OXQzF28hM1rNV7krvHhmwt31Hk3V+ehbimmpLaau6hwquYhfOk+9Ukpz01k0rYX8B/J4/TLdeo9BAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;White point of 1.5&quot;
        title=&quot;&quot;
        src=&quot;/static/0538b9a3fb3721c588173236e04e00bc/44427/white15.png&quot;
        srcset=&quot;/static/0538b9a3fb3721c588173236e04e00bc/d7a70/white15.png 180w,
/static/0538b9a3fb3721c588173236e04e00bc/0b140/white15.png 360w,
/static/0538b9a3fb3721c588173236e04e00bc/44427/white15.png 720w,
/static/0538b9a3fb3721c588173236e04e00bc/fff27/white15.png 1080w,
/static/0538b9a3fb3721c588173236e04e00bc/92da1/white15.png 1282w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/537799a08fe52dbbc705d7ec4a6a44b1/92da1/white3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 58.65834633385335%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADUUlEQVQozx2TW0ybdRjGe73EWJhsTGfpGIxTCysr0HKYlFJp+fqtB6C0pfSjpcAop0E5rYXSdQ6kTDIGhB0ibhkxiMRomMbtWo1XHmK8M97OeKcXXpn8/MeLJ3mvfs+T58mrmo72sJqc5cuvvmbv7hpjfol+n5uRfi8jfR5Wl1PcnZ9icSTE+ECAxFA/qeE+0hODrIyGUEIRZG8Y2RPCKaRyt9YiW5uYmZlmOBKmvU7HeDhIcjzGdmaK748e8cPRHi/313l2Z5qD1Xk+uz3BycYcL9cncDiDXGrwUG60U6W/gqrZ4sBo8VKmN6FW51OkOc/mzBAPbiZ4/jjH369+4q8/fuSX4/sc3ppjZ2GC/UWFZ+kRDpcGaDK/w4UrEiWGdspKL6Iy2zuokV0Y3W40lZVcOHeag2ycJ9kbfPEww5+/fcPvP7/gu8MdDjIJttJjfPJIpE/4OFgI0aArQZ2XT+HZMxS8cRqV03IZyWZmQOkjOhhjIhbhgxs+0VEvx3sZ/v3nFd8+XeNhLsnarEJm0s9uLiSS+tjLuKmrKSJPreZsQT4FQqqp7haSA23kEjJbyz4eZ/0sx+zcjF1jdSbI/r0US8Nett9Ps/3eHNFeM+kxB7srEqmpVsqKz3Pq1GuoX1cLcJ4A+tu4tyiRu+1gTejTHZls9F0GAx1MKi6i3VaGgh1E+lpZGuthVkAyyWaSyToSCRN+v57GFi31Zg2GBg2qW/M2jnfC3Jl0MilA8Wg71wda6VcaGY6J9cf9zE+H6fEYifqvklm282DXQ1+oFo+vipCiIxDW0xuqRnKXodrMdbK1IROJGekN1BIftRAdbWEpI7Gx7sbuqKDVqkVyVtIt63C7iknOmMhlr5JKCIisoc2upd1RjM1ZgqorWEOXX4fXp2du1ibcI6xk2rm/6eVgW6Gruxq7pEdyGHA56+ls02JvuUg8aGRjXtQQv4zs0GDrFLpWJIAB/f8wr7ea0aFmTj5WOPpIJp22i08pF2M4GVJsJOIBhpUO6vVvUluhxVBRRJ2+mI5GYWYpxWopxCqJDju7y3G5yoR7KQtjJn59HuDFhx5S4s5e13GybeHzvTb8nkuYavKwNhfSZCgU0LcwVAm47m3qqrWYTedobD7DfzYy9PhWrc7+AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;White point of 3&quot;
        title=&quot;&quot;
        src=&quot;/static/537799a08fe52dbbc705d7ec4a6a44b1/44427/white3.png&quot;
        srcset=&quot;/static/537799a08fe52dbbc705d7ec4a6a44b1/d7a70/white3.png 180w,
/static/537799a08fe52dbbc705d7ec4a6a44b1/0b140/white3.png 360w,
/static/537799a08fe52dbbc705d7ec4a6a44b1/44427/white3.png 720w,
/static/537799a08fe52dbbc705d7ec4a6a44b1/fff27/white3.png 1080w,
/static/537799a08fe52dbbc705d7ec4a6a44b1/92da1/white3.png 1282w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d386efd269d49de6a43fd683d99425ca/92da1/white5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 58.65834633385335%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADT0lEQVQozx2RTUzaBxyGOTdZpm4627VibSt+gBaHIhYjiFbgD4IgX4KggBYFP0CGForKohZbF0SjXdO16UiqW/Zhl6Xpkt269LIly25LdtqyZMcedtvp2T87PMnv9OT9va8kGXaxnU3z3YuXHN2/S9wrMOm2cyvgYNY/xk4+x/3MIqu3/MRDXlZmAmRnJsgnwuRjAUKBaayOIJaxgIgfiV3XhcXQx3JqmehUEEO3nPikj2w8QnljkdenD/jp5IiXnxb5bGuZyvaHfPVRgm/vpfm+mMAkTNDcY6NFZaS9oxuJVm+iW++kWa6mqroG6aWL7CWjHK+leP5ghzd/vubNHz/yy+clTjbTHGQSPF4NUsnPcpIL0afRcVk5wlXlMDJZCxKNcYTrozY+sNloaGvj8vl3qBTmeFJY4pvjdf7+7Qd+//mMV8/KVDZSlPLzPDsOc5ByUcn4Ucuv/B+kvq6O2ndrkAi6ToRhDVMhP+FIlERkir0ll9iRhy9F4b///MWrJzt8snub7ZUQGwseDu9OcJhxc7xhQ9Uppbqqivdqa6gVkSyNa8mG9OymLJRyLh4WPNyJGFmLWtlO+nj0cYY7M3b2t/LsF9KE3b3k40YO82aySzpkTRc5d+4tqt6uEsXVotA7SGnVTLFgZFvktGyhMD1MxDvCYmiUsNPAjO8mUxM6cvPjrCwMsL52g9trKlZSvXg8cvq0Uno0DSjVDUg200N8UQ6wtSCwIIrmw0PEQgMEghpmI+L6817SS0FcdhXTnn7Wczc5OrDhDygZc7fjD8nxBhW4/R0IdhmSvaKJUtHCVESFx9fFXEzPdKyf3LqYemcUo6kVnaERs6UNp1WO3dbEWlJNcbOfbFKBYG1g0NiIwdTEsHAViXOiE6dXjsOtIJ0ycFQOkl83sH/PztOSH4dTgdGswGxUMir0YB5sxNh/hTmfit30ANnYdaymBoZFhqxSUehT4HCJQkcHsaiWs0qA00cCOfG1WZ9MHMNMdHKIZMzLTHCEHsUFlK2NIlK6FU2M9Ikp9dcw6OsxCGKH5vEWRm0ybJZrZObU/Hrm5sVDG1nx3pyV83xfx9eHerxjzfR2VmPQ1nNDWU9X6/so2y/QJb9Ed0cjmt7z4jh1/AejM/Io+fP/yAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;White point of 5&quot;
        title=&quot;&quot;
        src=&quot;/static/d386efd269d49de6a43fd683d99425ca/44427/white5.png&quot;
        srcset=&quot;/static/d386efd269d49de6a43fd683d99425ca/d7a70/white5.png 180w,
/static/d386efd269d49de6a43fd683d99425ca/0b140/white5.png 360w,
/static/d386efd269d49de6a43fd683d99425ca/44427/white5.png 720w,
/static/d386efd269d49de6a43fd683d99425ca/fff27/white5.png 1080w,
/static/d386efd269d49de6a43fd683d99425ca/92da1/white5.png 1282w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;/div&gt;&lt;figcaption class=&quot;gatsbyRemarkImagesGrid-figcaption&quot;&gt;From left to right: images captured with white points of 1.5, 3.0, and 5.0&lt;/figcaption&gt;&lt;/figure&gt;
&lt;h2&gt;Filmic Curves&lt;/h2&gt;
&lt;p&gt;While Reinhard is clearly better than nothing, the industry has appeared to move towards other curves that are more customizable, especially in terms of how they behave towards the extremes. Romain Guy created an excellent &lt;a href=&quot;https://www.shadertoy.com/view/WdjSW3&quot;&gt;shader toy&lt;/a&gt; demonstration of these different curves, which I’ve modified slightly, adding the two reinhard curves.&lt;/p&gt;
&lt;p&gt;I decided to try out each of the curves that were used in &lt;a href=&quot;https://www.shadertoy.com/view/WdjSW3&quot;&gt;Guy’s shadertoy&lt;/a&gt;, which include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;a href=&quot;https://en.wikipedia.org/wiki/Academy_Color_Encoding_System&quot;&gt;ACES&lt;/a&gt; curve, with implementation from &lt;a href=&quot;https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/&quot;&gt;Narkowicz&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;The tone curve from Unreal Engine, based off the ACES curve. Couldn’t find too many details on this implementation, but its very close to the ACES curve.&lt;/li&gt;
&lt;li&gt;The &lt;a href=&quot;https://www.desmos.com/calculator/gslcdxvipg&quot;&gt;Gran Turismo curve&lt;/a&gt; by Hajime Uchimura&lt;/li&gt;
&lt;li&gt;Curve presented by &lt;a href=&quot;http://32ipi028l5q82yhj72224m8j.wpengine.netdna-cdn.com/wp-content/uploads/2016/03/GdcVdrLottes.pdf&quot;&gt;Timothy Lottes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;gatsbyRemarkImagesGrid&quot;&gt;&lt;div class=&quot;gatsbyRemarkImagesGrid-grid&quot; style=&quot;
            grid-template-columns: repeat(auto-fill, minmax(48%, 1fr));
          &quot;&gt;

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d64834f38188c9d0f443bc5968a9e072/ae828/ACES_per_channel.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADJ0lEQVQozxWSW0zbBRSH+6DbCt3GbShObqNQLm3taCktlQK9ASnQMlrYsgEtXSeU0aaxUvgzx1gArWxYOg27OEIWweCctM5saKJZ1MTFaeRNTXxwiYmamBgXff78e5KT7+13vnNyJJkVgbvJWT5OLfHtZ2n++ft3/n3yJz/vfs5XG5fZSgikE1HuLb/Mg2sC99+MkkmE2BZ7TRgkMeoiFfWwNO7i/KAVyb23Y2RWL/DBcpSv76/xx68/8uSv3/jlh2949P5brF8Q2F4Jkb4UYOeNMe5M97MRH+DW9CmS4WPMDlvFIAuTA81MHTcjSU32MRPycmtxhC8zq/xfj7/7hC+2r/HpeymuxH1kNie4Oe/hzlwfm1Muls86uHjGijBqIBbQc3HEzqy/nZkh0fC8vxnBb2Up0s3NhSAPH6S5nRS4LZ5iZ+syiZiLd5aGmRzt5LW4h5mRVubDFhZjHUyFmwic1HKqV4ffrafbUYVk3ieqjliIDzvEYCdnuvSctKsZ8+mIRVQIEx1Mj9vwD9Qz/8ppBj1KnN2lHO9X0j+gwNJTSqOliObW59Cb85HEvHq8Tg1up4rxoSbCovaNKz6GxzQMDR5lIR5kcWqcYU8zHqcST18ljp4iGswFNNoP0WArpKXrWQy2ArTWHCQTIS1d/QriM02ce9XEpdd7EAQ7DncZrbYKIkEn3l4NXR3VhANGOp3F6JpzMdkOUf9iDkr9fkz2XHFIIWqTDIl/VEMgXM/6+mk+SodZTbYRClZhbX8GgzkPnS4Pu70YtSaPlsYyhlwlGIwH0LYcpK5RRrU2W2S2SCm1+mwkcwkLGx++xMK5Y2xeHeen3UWuJ92420sw1stoM8uJiL8WDfbg7TTxQkUhR5WimUZGZa2UI3VSytX7KFPvocYoRfLumoWlZAeRCRMnuou5u3WClbk2fG45etUB1HIp9TUHUVcWoCjLofxwPlXVonlbLnUGGbVG0a5hH+WqPZRrspB8//AsV1MeXJbn8fXu59GOg8e7IRIzNWjrcqkozqK86CmK859GfliKolRct66EWnU+cpWMUuVejqj2IleIVGfxH/6iyvgTcP0qAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;ACES&quot;
        title=&quot;&quot;
        src=&quot;/static/d64834f38188c9d0f443bc5968a9e072/44427/ACES_per_channel.png&quot;
        srcset=&quot;/static/d64834f38188c9d0f443bc5968a9e072/d7a70/ACES_per_channel.png 180w,
/static/d64834f38188c9d0f443bc5968a9e072/0b140/ACES_per_channel.png 360w,
/static/d64834f38188c9d0f443bc5968a9e072/44427/ACES_per_channel.png 720w,
/static/d64834f38188c9d0f443bc5968a9e072/fff27/ACES_per_channel.png 1080w,
/static/d64834f38188c9d0f443bc5968a9e072/ae828/ACES_per_channel.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6939f9fc320b4786d04a5e8517506a1d/ae828/unreal.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADJElEQVQozxWPT0ybBRiHvwzKKkgZogtjNpWOv6UFpHRtQUpZWwpjtLQFVjSjoy3MUehqgA749gcRWCgbFJzbMhayDF2GUKbDRKLRxYOYKCc18WAWD+rBxMMOXs3j5+GX9z28z5PfK6SSIo+XpvhkOcHe7ibP//6df57/xS8/fMHT9Rs8TIhszY/wZHGUL++I7CyNkJofYlPKPTHA/KCH5ZHTLAx7uRpwIOx8MEbq1jQbiyN882SVP3/7SZL+wa8/7rH36CZr715iazlCaqGfnUSEDbGHB+M93JdkyVgXU0G7JLIx/qaFybcaEVbGuxEj3dyfC/N16hbwL8++3+WrrTvsPnyflfEQ2+tDrM50sTHdzfqEl8VoC9PnHRJnZmzAwHthJ1PhVi71SQ2vhhoRQ3YS77glaIDvnm6zuXKZR8lJPv94ifm4h9XrAUYHWpiL+6TbJmZiNmbjrUzG6uk/U0Ovr5agx4DbWYQwG7IwEbYzEXQihl2cd5s446xksK+WsZiWyaiTiSE7ge7XmR4N0dtVQXuHEr9fg7+nGLu0m+yHsZw4zPFGBULcb8TfXo3HpWW4r54LZ+3cXQkQjFQR6K1iJh5i7uIgvZ31+No0dPrUODv+hw9hduZyvPklrK6XMTcfQu/IQohGanD5i7komrl8pZ7r104hijZafCqsNhXR/pN0enScailhOGyipa0AgyWbNxy56Buy0Brl1DuycbrzqGyQI4QHq+iPVbO2FuLT7WFuJ60MnSui+WQeRouCGr0Cm/0IuioFFoOSgPsodXUvUNuUicZ0kFJ9BhqjNGtllBszEKauWflwa4AZ0c36zbf5eX+Wu0kXvlYJ1MuxNhQSPefiQrgdr9NElTqP6oosKqoPcqxcxmuadFSVaSgrD1BmTkd4cK+JhaSDWNSMv+0Ijz86zfJ0I0GvGqMuC51aRk2p9Jo6l2Lli6jycygqUWA4kS01lFNel0GpQZLqDqCqliHsfzvE7eUOvPZ8znZksveZnWf7ERJXyjBUZFNYkIHqFYGCHAF1fjrFr2ZSozlKmTaHYzo5Sm0aKinqkjQKK2X8BywWySETkrYKAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Unreal&quot;
        title=&quot;&quot;
        src=&quot;/static/6939f9fc320b4786d04a5e8517506a1d/44427/unreal.png&quot;
        srcset=&quot;/static/6939f9fc320b4786d04a5e8517506a1d/d7a70/unreal.png 180w,
/static/6939f9fc320b4786d04a5e8517506a1d/0b140/unreal.png 360w,
/static/6939f9fc320b4786d04a5e8517506a1d/44427/unreal.png 720w,
/static/6939f9fc320b4786d04a5e8517506a1d/fff27/unreal.png 1080w,
/static/6939f9fc320b4786d04a5e8517506a1d/ae828/unreal.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5e6c5c4f61f33ae8c0f409a7b2792669/ae828/lottes_per_channel.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADKklEQVQozxWSW0zbBRSHG5Wt0F3sZKi7IAPK2hTaMlp6GffeKHallQKdDiiFymixhdmtpcCG4EAusxVmJsucCxIy5wijy8SZmEWjcdEt6pPR+MCLMVmMiYs+f/53kpPfyUnOd34nOaLMwgi30+PcWZzj4b0N/n38iP8e/8XvP37JNyvzfDKbZGPmFJupGF8tJQUdIjMTZl3Iq8kOZvvdLAy1MRd2c7bDguiz92NkLo1zM3WK+3ev8eiPX/nn7z/Z+uV7frhxkWvjSdYXQmzM9/L5bD9rw+2sxn0sC7B0pIVzfosAMhP31ZA4XosoFfMyFm7j4+kevr19mSex9WCTr9eX+GL1PRbj3WRWI3w46WVtwstqws27b9iZ7LOS7DdyulfPRMDOuUAjI11WRGcDtYwELMwNurg61cf9e7f4NDXMzcUxNq9fYCbm5sp8F2dONjEdb2W0p563Iw1MnXYQjxyl94SWDo+Obo8el/0wogl/LYkeCwm/nWTASZ9TzwmbmlC3jlhUxUjUwXDYSsBXwfkzQTpbVTibCzjuK6PdJ8cs1EbzPmoa9qGv3YPozTYDrc5yPMdUDHRVMei3cuViN/5+DV2d5ZxPBJlKhARQNV6nEm+LDHuzMFyXi9G2F70tj3rXCxituWituxFFwlqOtcsZHq1idKyKCzNukkkrds8h6q1FRIMv0/aKBleTgkivkSbnQSprpFRZ96Kt3k2ZYQfVNil2Vx6aagmiwEkNvdEKlpdfJ3MrwqV0PaFgCVbH8xiEE7Q6KTbbAdTlUuoMBXQ2H8Rk2omufhelBgkKbY6gOSh0YpSGbESTcxZW1vqYGmvh+uUBfvt5mqWUG09jPiathIaaYgaFXxsKumh1HEVTnMeRMsFZeQ4lSjFFpdspVG/jkCYLpWk7opWPzMymG4kOmHhN2H7nxquk36rD75GhV+1CLRNToRC0JBd5wbMU7t/DYYWUygYppUaJAMlGUfkE+gyFRwSHD78L8cFiO83m/fR4d/DgroOtn8K8k5SjLZVSnC+m8MWnyM99GtkBMfKXdgr9fJTq55CpJBSUbaNIlYVMkUWROpv/AX4SzFlK3c5/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Lottes curve per channel&quot;
        title=&quot;&quot;
        src=&quot;/static/5e6c5c4f61f33ae8c0f409a7b2792669/44427/lottes_per_channel.png&quot;
        srcset=&quot;/static/5e6c5c4f61f33ae8c0f409a7b2792669/d7a70/lottes_per_channel.png 180w,
/static/5e6c5c4f61f33ae8c0f409a7b2792669/0b140/lottes_per_channel.png 360w,
/static/5e6c5c4f61f33ae8c0f409a7b2792669/44427/lottes_per_channel.png 720w,
/static/5e6c5c4f61f33ae8c0f409a7b2792669/fff27/lottes_per_channel.png 1080w,
/static/5e6c5c4f61f33ae8c0f409a7b2792669/ae828/lottes_per_channel.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2a7070240ba6cd9e16e5fbb4ff2030bf/ae828/uchimura_per_channel.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADHUlEQVQozw2PTUzbBRyG/4fJVqiQAm4yPltKvyilLWsp/WDQUmnL1q4tW5uWUmlLkUIHg+6jK8E5dOAwU9kC24QYZ0gwmOjJg9k0WaLxYOJFDyaamJiY7OKFg17M4//wy3t4k+d9fsJOeYbH5Tn2KiW+OXzEv0d/8c/RC355fsgXd69yb3mGnaU0e9enOLiVFzPN9lKCB+K9nQ+xHB/hZtpHKTFCIWRH2F3JsL06z9a1NF99usGLP37i6O8/+e3Hr3n2QYU78+Lgm0keXh1nbznOVt7PZi7Aej7IjdRrFMJ2ZkMDZAMWpsesCCuZUd5I+FlfCPPl3gbwH78+3efz7TX2779FOXOBJw9zbCwF+HB+lM3pEa4lXRRjDvJxE5lxI8Wok0LExcwFB0IhYmUm6mA5NcxGKcHzp4d8tLbAo7VFPtt9hytpN3dXYhRSHm4UgsxGbVxODbCYGSQ30cf4eQNBr4GLoyY8rk6EYtjKdNTOdNhFPjJExKVnzK4hHjGQmdRQzLoppM8SCxooz6cIB7QMuVs5F9DgH1Ni97RhGmjCamvCaK1HmPKb8A13MzKsIRHqY2rcxb07lwjHdUQjPVQWJqks5hg/ZyPgVuP3KXB6XsXY34jJ2YjRcRKb+xRmRwMGRx3CZNKAO6Bkrmhlbs7CatnH5eIgzpE27C45uaSX8369OKji9Vgfw54WDBYZZxyN9Fjq0BhfxuKU4fK8gu6MFCES03FxsocHW0n2P8ny7q0BJmIKEXYSU7+M3l4ZQ2eb0XXLsJvbiHibMZlrMfTXoTZK6eqpQW2qQWmQoDJWI5RuOnn8cYLKlQBP7mf5+Ycy790O4B1swayX4rApyKfHyE/4CXr60XY0oteIZt01KFQSOtQnaNcdp01Xhcp8AmHnfTurtz3ksxbC3tMc7IZYK9lFEwW9mlq0cgk9XbXoFA10ttbR3lRPZ5doPiATzaQipJquXhGqfYn2btHwu2cTbK4H8TqbueST8u3BIL9/n+D6rBK9qh55i4T2U8doaTiG/LREhIrvqptRacVOK6VVc5wObRVyZZUIreZ/V2ewWksYhOUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Uchimura curve per channel&quot;
        title=&quot;&quot;
        src=&quot;/static/2a7070240ba6cd9e16e5fbb4ff2030bf/44427/uchimura_per_channel.png&quot;
        srcset=&quot;/static/2a7070240ba6cd9e16e5fbb4ff2030bf/d7a70/uchimura_per_channel.png 180w,
/static/2a7070240ba6cd9e16e5fbb4ff2030bf/0b140/uchimura_per_channel.png 360w,
/static/2a7070240ba6cd9e16e5fbb4ff2030bf/44427/uchimura_per_channel.png 720w,
/static/2a7070240ba6cd9e16e5fbb4ff2030bf/fff27/uchimura_per_channel.png 1080w,
/static/2a7070240ba6cd9e16e5fbb4ff2030bf/ae828/uchimura_per_channel.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;/div&gt;&lt;figcaption class=&quot;gatsbyRemarkImagesGrid-figcaption&quot;&gt;Clockwise, starting from the top left: the ACES, Unreal, GT, and Lottes.&lt;/figcaption&gt;&lt;/figure&gt;
&lt;p&gt;Each of the tone curves will produce a slightly different “look” to the final image, but it should be obvious that the filmic curves produce a vastly different image from the others. The filmic curves produce a less “washed out” image than the Reinhard curves.&lt;/p&gt;
&lt;p&gt;I should also note that the choice to apply the curve to the Luminance values exclusively rather than each RGB channel individually is a choice. John Hable &lt;a href=&quot;http://filmicworlds.com/blog/filmic-tonemapping-with-piecewise-power-curves/&quot;&gt;advocates the latter approach&lt;/a&gt;, but this will result in shifts in Hue. &lt;a href=&quot;https://www.ea.com/frostbite/news/high-dynamic-range-color-grading-and-display-in-frostbite&quot;&gt;This presentation by the Frostbite team&lt;/a&gt; provides an example of hue preserving vs non-hue preserving tone mapping.&lt;/p&gt;
&lt;p&gt;I tried out both methods, and I think that John Hable is probably right here. Applying it solely to the luminance produces some weird behaviour, especially around the sun and highlights, but it also clearly shifts the hue of the final image. The following figure shows the difference for three of our previous curves: ACES, Uchimura, and Lottes.&lt;/p&gt;
&lt;figure class=&quot;gatsbyRemarkImagesGrid&quot;&gt;&lt;div class=&quot;gatsbyRemarkImagesGrid-grid&quot; style=&quot;
            grid-template-columns: repeat(auto-fill, minmax(48%, 1fr));
          &quot;&gt;

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a56f0d1f0d7e0c89a2c79b791aa76492/ae828/ACES.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADJUlEQVQozw2QS0zTBxzH/ycPDjW8X0GgFAx90BRpy6ulFOwDWmxLgQGWFgorMCgdWFqQGmZVNkDloZOF4GNhzhFRN9nUoAcvy8ge7LAtO+y0XZbskZDssGRLPvsffvl+L99PPvkJT5bjPF2a5fnKPD/u3uO/P/f49699fvtmm/3NK2zNx9l5d5Lda1H23o/zcmmSnfkwn4i3ca6fi0PtXB33cnnkdaI+O8LL92I8uZng0bVJvv1sjYNfdvnnj1f8/v1zfr6/wu23Z3i8MsbO4jAvFsJsz/jZnPJzR4QthruZ6rWLoGbGOs281WVBWIt1Ex3u4oO5Ib54dAP4m4Ovd/jy4RovPrrOcizIp/fGuXXJy3aihw+nu1gIuTg/2EJ0qJFwfz3nAqeZCjiJ+B0I031WIn125sLtrF8aZu/VXR6sxtgSX/Fsa4V3Ip2sLwQ5G2zhYlQ0Cti4MOYgcdZNNGSht1tPp6uWHlcNzaeUCOdF4ETAzri/hUigFb/DiMesY8Bfx0Somtiog8k3Hfg6qrgQeYMzHg3NdhkdbRra28tpFHuVsQh9nQRdbS5CqMOI216Jo1lD0HeKYZ+VW6t++gZr8XqrmY0GmY2F6PbU47GraXWXYXVIxXEe1Q35VJkKMDVJqDHloa3PRhgZMtDiKWdqykR8xsyVuVbi001YTyuoM5UyOuCkzaWhyaIiFDBisxWjrcmh1nSciuosyirSxJ6DzZGPuioNoTeop3/UwObtAE8fD7O+ZGFkQE2DWUKlPpuKikzMjRKUqkwMOileZwm6ygw0+kyUmlRk6mQxU5CVH0OhSUZIXLbx4GEvczNuPr7p49fvJthYduKwnkBbnorRIFoOthEaaMVtMyCX5qBSpKNQpVBcehRp6RGkiiSKFIdRaI8ibG1YuLpkZXy0lg57Ec/ut3E90cAZl4qTynTkxUdQlaaJmUVxQSoFuemUnMhAV5dDmTYVpS4Z2UkRLAKlZSLwp6/8rK26aGoopMeZwQ+f2zjY72ExrkUlz6YwL4nj2YfISTtEYW4S0vxk1PJCZIosShQpSOSinfw1pCWHKVYc439PV89G4te3awAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;ACES curve&quot;
        title=&quot;&quot;
        src=&quot;/static/a56f0d1f0d7e0c89a2c79b791aa76492/44427/ACES.png&quot;
        srcset=&quot;/static/a56f0d1f0d7e0c89a2c79b791aa76492/d7a70/ACES.png 180w,
/static/a56f0d1f0d7e0c89a2c79b791aa76492/0b140/ACES.png 360w,
/static/a56f0d1f0d7e0c89a2c79b791aa76492/44427/ACES.png 720w,
/static/a56f0d1f0d7e0c89a2c79b791aa76492/fff27/ACES.png 1080w,
/static/a56f0d1f0d7e0c89a2c79b791aa76492/ae828/ACES.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d64834f38188c9d0f443bc5968a9e072/ae828/ACES_per_channel.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADJ0lEQVQozxWSW0zbBRSH+6DbCt3GbShObqNQLm3taCktlQK9ASnQMlrYsgEtXSeU0aaxUvgzx1gArWxYOg27OEIWweCctM5saKJZ1MTFaeRNTXxwiYmamBgXff78e5KT7+13vnNyJJkVgbvJWT5OLfHtZ2n++ft3/n3yJz/vfs5XG5fZSgikE1HuLb/Mg2sC99+MkkmE2BZ7TRgkMeoiFfWwNO7i/KAVyb23Y2RWL/DBcpSv76/xx68/8uSv3/jlh2949P5brF8Q2F4Jkb4UYOeNMe5M97MRH+DW9CmS4WPMDlvFIAuTA81MHTcjSU32MRPycmtxhC8zq/xfj7/7hC+2r/HpeymuxH1kNie4Oe/hzlwfm1Muls86uHjGijBqIBbQc3HEzqy/nZkh0fC8vxnBb2Up0s3NhSAPH6S5nRS4LZ5iZ+syiZiLd5aGmRzt5LW4h5mRVubDFhZjHUyFmwic1HKqV4ffrafbUYVk3ieqjliIDzvEYCdnuvSctKsZ8+mIRVQIEx1Mj9vwD9Qz/8ppBj1KnN2lHO9X0j+gwNJTSqOliObW59Cb85HEvHq8Tg1up4rxoSbCovaNKz6GxzQMDR5lIR5kcWqcYU8zHqcST18ljp4iGswFNNoP0WArpKXrWQy2ArTWHCQTIS1d/QriM02ce9XEpdd7EAQ7DncZrbYKIkEn3l4NXR3VhANGOp3F6JpzMdkOUf9iDkr9fkz2XHFIIWqTDIl/VEMgXM/6+mk+SodZTbYRClZhbX8GgzkPnS4Pu70YtSaPlsYyhlwlGIwH0LYcpK5RRrU2W2S2SCm1+mwkcwkLGx++xMK5Y2xeHeen3UWuJ92420sw1stoM8uJiL8WDfbg7TTxQkUhR5WimUZGZa2UI3VSytX7KFPvocYoRfLumoWlZAeRCRMnuou5u3WClbk2fG45etUB1HIp9TUHUVcWoCjLofxwPlXVonlbLnUGGbVG0a5hH+WqPZRrspB8//AsV1MeXJbn8fXu59GOg8e7IRIzNWjrcqkozqK86CmK859GfliKolRct66EWnU+cpWMUuVejqj2IleIVGfxH/6iyvgTcP0qAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;ACES curve per channel&quot;
        title=&quot;&quot;
        src=&quot;/static/d64834f38188c9d0f443bc5968a9e072/44427/ACES_per_channel.png&quot;
        srcset=&quot;/static/d64834f38188c9d0f443bc5968a9e072/d7a70/ACES_per_channel.png 180w,
/static/d64834f38188c9d0f443bc5968a9e072/0b140/ACES_per_channel.png 360w,
/static/d64834f38188c9d0f443bc5968a9e072/44427/ACES_per_channel.png 720w,
/static/d64834f38188c9d0f443bc5968a9e072/fff27/ACES_per_channel.png 1080w,
/static/d64834f38188c9d0f443bc5968a9e072/ae828/ACES_per_channel.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3e68fead053edd3f5ee68c66979039f9/ae828/uchimura.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADFUlEQVQozxXNT0ybBRjH8fek0bFB13UdbFDKoLxtt5ZSCrRdoe0rf0q7Dt42VAovf1qgzUptXaEd0zAXBuIWImRjEweLxOi2RBO96EUTtoMmauJVL/PkaYkeTEyMh6+vhye/X57k+TzCveUsu8s59q4tcvj4Lv/+8QP//Pkzvz79mC9uX2WzlOXelTR7lTSPr2fZr6TYKSncKU2ymolTGAtRmY5SHB9ibtiPsP/2LDsrebbLKb46eJcXz7/m7xeH/PbTlzzbXmFtIcMH16e5vzTG3qLCVmaY9+aGWVOx8mSEedmvQr1Mhr1MRy4grMxGmEtGWC+M8vnuTeAvnn/7iM92VvnkziqVVJyD+1k2SiNs5aPcmo+wOPEalxMBZl93MxXvIhsPMh+TSI8EEDIxH+mYnzeVQdauTPD0m30+XMuzc6PIk/0NitNDbLylkFEGWMrJzMd95BU/b6T6mJ3wIl/sINLnJDbQQdAnIlyWfcyo4IwcJBXrI9rjZMBrY3TExYziIKceZqf6iF9sp5ybZDhkwx9sJqxmaMiKV+3t3Q10quNwnUJQhroYCLQR9NtIXPKgxHp5fz1BLNGOLDupFKYpFzPIES+hoJXQoEhP0KAe1+L0nMbhOYM7UK/2WuxunQomXUghK7mcl4Wcj5WrYQr5ID6pBfeFFlLjg0RC/z+0MDXaTSBgxN6hx+Wpw9ahw2w/rnY9vdJprM7jCHLCyaji4u5WkkcHKW6/40dJWFSsnvZOPXabjt4eA2arjm6nEbnfSJtDi73zhIppMJ2rRrTXYDp/TM1qhFLZz8OPxrhWDHOwPc4v3xfYXA0h9TbRdk6Dp9tEeipKeiLCkOTG1KjHImoRrTU0mY5iNFVhNB+hUXwF0VGFsLvp58aqRGa2i6hk4MmDS9xc8jHcL3LerKXVWIW1RYPYpKOpXkNDnZazzSdo69JjblP3jmpMNhVVQaPlKMKPh0lurYeRfA3E+rU8+1Ti9++SLC/YsJhO0nimivpTL1GrfRlDXZWK1mBtbcAknuSsqMHQegRj66sYm1XQfIz/AMflsm+Uvu3VAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Uchimura curve&quot;
        title=&quot;&quot;
        src=&quot;/static/3e68fead053edd3f5ee68c66979039f9/44427/uchimura.png&quot;
        srcset=&quot;/static/3e68fead053edd3f5ee68c66979039f9/d7a70/uchimura.png 180w,
/static/3e68fead053edd3f5ee68c66979039f9/0b140/uchimura.png 360w,
/static/3e68fead053edd3f5ee68c66979039f9/44427/uchimura.png 720w,
/static/3e68fead053edd3f5ee68c66979039f9/fff27/uchimura.png 1080w,
/static/3e68fead053edd3f5ee68c66979039f9/ae828/uchimura.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2a7070240ba6cd9e16e5fbb4ff2030bf/ae828/uchimura_per_channel.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADHUlEQVQozw2PTUzbBRyG/4fJVqiQAm4yPltKvyilLWsp/WDQUmnL1q4tW5uWUmlLkUIHg+6jK8E5dOAwU9kC24QYZ0gwmOjJg9k0WaLxYOJFDyaamJiY7OKFg17M4//wy3t4k+d9fsJOeYbH5Tn2KiW+OXzEv0d/8c/RC355fsgXd69yb3mGnaU0e9enOLiVFzPN9lKCB+K9nQ+xHB/hZtpHKTFCIWRH2F3JsL06z9a1NF99usGLP37i6O8/+e3Hr3n2QYU78+Lgm0keXh1nbznOVt7PZi7Aej7IjdRrFMJ2ZkMDZAMWpsesCCuZUd5I+FlfCPPl3gbwH78+3efz7TX2779FOXOBJw9zbCwF+HB+lM3pEa4lXRRjDvJxE5lxI8Wok0LExcwFB0IhYmUm6mA5NcxGKcHzp4d8tLbAo7VFPtt9hytpN3dXYhRSHm4UgsxGbVxODbCYGSQ30cf4eQNBr4GLoyY8rk6EYtjKdNTOdNhFPjJExKVnzK4hHjGQmdRQzLoppM8SCxooz6cIB7QMuVs5F9DgH1Ni97RhGmjCamvCaK1HmPKb8A13MzKsIRHqY2rcxb07lwjHdUQjPVQWJqks5hg/ZyPgVuP3KXB6XsXY34jJ2YjRcRKb+xRmRwMGRx3CZNKAO6Bkrmhlbs7CatnH5eIgzpE27C45uaSX8369OKji9Vgfw54WDBYZZxyN9Fjq0BhfxuKU4fK8gu6MFCES03FxsocHW0n2P8ny7q0BJmIKEXYSU7+M3l4ZQ2eb0XXLsJvbiHibMZlrMfTXoTZK6eqpQW2qQWmQoDJWI5RuOnn8cYLKlQBP7mf5+Ycy790O4B1swayX4rApyKfHyE/4CXr60XY0oteIZt01KFQSOtQnaNcdp01Xhcp8AmHnfTurtz3ksxbC3tMc7IZYK9lFEwW9mlq0cgk9XbXoFA10ttbR3lRPZ5doPiATzaQipJquXhGqfYn2btHwu2cTbK4H8TqbueST8u3BIL9/n+D6rBK9qh55i4T2U8doaTiG/LREhIrvqptRacVOK6VVc5wObRVyZZUIreZ/V2ewWksYhOUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Uchimura curve per channel&quot;
        title=&quot;&quot;
        src=&quot;/static/2a7070240ba6cd9e16e5fbb4ff2030bf/44427/uchimura_per_channel.png&quot;
        srcset=&quot;/static/2a7070240ba6cd9e16e5fbb4ff2030bf/d7a70/uchimura_per_channel.png 180w,
/static/2a7070240ba6cd9e16e5fbb4ff2030bf/0b140/uchimura_per_channel.png 360w,
/static/2a7070240ba6cd9e16e5fbb4ff2030bf/44427/uchimura_per_channel.png 720w,
/static/2a7070240ba6cd9e16e5fbb4ff2030bf/fff27/uchimura_per_channel.png 1080w,
/static/2a7070240ba6cd9e16e5fbb4ff2030bf/ae828/uchimura_per_channel.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/874e2436d093bc49b4ea65793a9ab05f/ae828/lottes.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADJUlEQVQozw2RW0zbdRiGe7dkE1TWCXQ4SKFAoAcOo4extusoK3/sAYpd2YC2QJHCpO2GlHIaYR1CYAM7xI3MHTTbVNTqTOM2J8Z4YbKZZdy4xAtv9MqYxZB4YaLJ4+/qy5d8efK87yfLpme4l57jm0tLPHt4h/+eP+bfv57yx5MM27dX2FyeIbuU4NvVcR5vzLD1TkLsce4uneba9ADzw35WRntYGDlBMuRC9t17SbKXU3yxmuDp11fY+e0h/zz/gT9/fsCvn6xx89w0d9diZC+cYms5TmY6xK2JEDenBrgY72ayz0Uy6CR+0sGZrhZkGxNdJIe7+HBhiB8z68Df7DzJ8ihzha2P1rmUHOSrO2e4Pt9DJhXg9mQXF6JeZiNukkPNnA7bmA57mAy3kegVhlP9Eol+J4txP1fPD/Po+w/4fC3JpqjiweYai2MnubocYSziYT4pjMISqZiL1JiXZMxBX7eZLq+ZoLcRl0OLbFYA3wq7GO11kwh30Oexcdxh5I2QldFYI8moi/E3XQT9Js4lBunxNeB0V9Hp1+PvrOeYu5rGo2VYbKWYLEXIYidsvO4y4XHqiQSbORWSuPFuiP4hM4HAIebGB5mbiNHtE3fOOnwdWiS3CqPlVRrtxRyyl9DkLOWw/QCGo4XIRoateI7XMzHZxNkZBysLHZydakVq13CkqYroQBt+rx6nVENU9NX6mgqDWYFFwPSHC9Hp5ZjtClrdJdQ1ypH1RcwMjFi4daOf+18O8366hehgHfYWpYigoKGhAMexUnQ1BViNKoLtFZhM+RisBegMe6muz0OrzxPzJTFfRpZ6W+KzTC+LM142Lwf5fXuU6+k2PFIlhno5NquwHPIJ0w68kgV12X5qNPvQ1uZRUZWLqjoHlTaHMs0etMZcZJ9ec7CalsQDzHSKLu5/7GP9vJ2AV8dB3SuoVbnUVMlRlxdQXiKnpGgf5ZX5GI/sF4ZyAclDfVCANbtR6QTwl5962Vhrx9msFHHyeXZPYmc7wMqsgVqNAuWBHIoLd6GQ70JZJGyK86hVK6nWFFKh3Uup+gVU6j2oKndTrn2R/wFDe9E0Ut640QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Lottes curve&quot;
        title=&quot;&quot;
        src=&quot;/static/874e2436d093bc49b4ea65793a9ab05f/44427/lottes.png&quot;
        srcset=&quot;/static/874e2436d093bc49b4ea65793a9ab05f/d7a70/lottes.png 180w,
/static/874e2436d093bc49b4ea65793a9ab05f/0b140/lottes.png 360w,
/static/874e2436d093bc49b4ea65793a9ab05f/44427/lottes.png 720w,
/static/874e2436d093bc49b4ea65793a9ab05f/fff27/lottes.png 1080w,
/static/874e2436d093bc49b4ea65793a9ab05f/ae828/lottes.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5e6c5c4f61f33ae8c0f409a7b2792669/ae828/lottes_per_channel.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADKklEQVQozxWSW0zbBRSHG5Wt0F3sZKi7IAPK2hTaMlp6GffeKHallQKdDiiFymixhdmtpcCG4EAusxVmJsucCxIy5wijy8SZmEWjcdEt6pPR+MCLMVmMiYs+f/53kpPfyUnOd34nOaLMwgi30+PcWZzj4b0N/n38iP8e/8XvP37JNyvzfDKbZGPmFJupGF8tJQUdIjMTZl3Iq8kOZvvdLAy1MRd2c7bDguiz92NkLo1zM3WK+3ev8eiPX/nn7z/Z+uV7frhxkWvjSdYXQmzM9/L5bD9rw+2sxn0sC7B0pIVzfosAMhP31ZA4XosoFfMyFm7j4+kevr19mSex9WCTr9eX+GL1PRbj3WRWI3w46WVtwstqws27b9iZ7LOS7DdyulfPRMDOuUAjI11WRGcDtYwELMwNurg61cf9e7f4NDXMzcUxNq9fYCbm5sp8F2dONjEdb2W0p563Iw1MnXYQjxyl94SWDo+Obo8el/0wogl/LYkeCwm/nWTASZ9TzwmbmlC3jlhUxUjUwXDYSsBXwfkzQTpbVTibCzjuK6PdJ8cs1EbzPmoa9qGv3YPozTYDrc5yPMdUDHRVMei3cuViN/5+DV2d5ZxPBJlKhARQNV6nEm+LDHuzMFyXi9G2F70tj3rXCxituWituxFFwlqOtcsZHq1idKyKCzNukkkrds8h6q1FRIMv0/aKBleTgkivkSbnQSprpFRZ96Kt3k2ZYQfVNil2Vx6aagmiwEkNvdEKlpdfJ3MrwqV0PaFgCVbH8xiEE7Q6KTbbAdTlUuoMBXQ2H8Rk2omufhelBgkKbY6gOSh0YpSGbESTcxZW1vqYGmvh+uUBfvt5mqWUG09jPiathIaaYgaFXxsKumh1HEVTnMeRMsFZeQ4lSjFFpdspVG/jkCYLpWk7opWPzMymG4kOmHhN2H7nxquk36rD75GhV+1CLRNToRC0JBd5wbMU7t/DYYWUygYppUaJAMlGUfkE+gyFRwSHD78L8cFiO83m/fR4d/DgroOtn8K8k5SjLZVSnC+m8MWnyM99GtkBMfKXdgr9fJTq55CpJBSUbaNIlYVMkUWROpv/AX4SzFlK3c5/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Lottes curve per channel&quot;
        title=&quot;&quot;
        src=&quot;/static/5e6c5c4f61f33ae8c0f409a7b2792669/44427/lottes_per_channel.png&quot;
        srcset=&quot;/static/5e6c5c4f61f33ae8c0f409a7b2792669/d7a70/lottes_per_channel.png 180w,
/static/5e6c5c4f61f33ae8c0f409a7b2792669/0b140/lottes_per_channel.png 360w,
/static/5e6c5c4f61f33ae8c0f409a7b2792669/44427/lottes_per_channel.png 720w,
/static/5e6c5c4f61f33ae8c0f409a7b2792669/fff27/lottes_per_channel.png 1080w,
/static/5e6c5c4f61f33ae8c0f409a7b2792669/ae828/lottes_per_channel.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;/div&gt;&lt;figcaption class=&quot;gatsbyRemarkImagesGrid-figcaption&quot;&gt;On the left, the curve is applied to only the luminance; on the right it is applied per RGB channel.&lt;/figcaption&gt;&lt;/figure&gt;
&lt;h2&gt;A note on Gamma Correction&lt;/h2&gt;
&lt;p&gt;I won’t go into gamma correction in great detail, but it is an &lt;em&gt;essential part&lt;/em&gt; of not only tone mapping, but working with color values in computer graphics in general. But in order for our image to appear correctly even after tone mapping, we need to apply a gamma correction because displays do not expect linear values. A big reason for this is because human perception of brightness is &lt;em&gt;not linear&lt;/em&gt;. If you don’t know much about Gamma or what I’m talking about, here’s a few great reads:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.johnnovak.net/2016/09/21/what-every-coder-should-know-about-gamma/&quot;&gt;What Every Coder Should Know About Gamma&lt;/a&gt; by John Novak&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Gamma_correction&quot;&gt;Wikipedia Page on Gamma Correction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.teamten.com/lawrence/graphics/gamma/&quot;&gt;Gamma Correction in Computer Graphics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;There were many different curves presented in this post, which one you want to use is an artistic choice. Personally, I like the look of the GT curve the most. But the ACES curve has gained a lot of popularity in the past few years.&lt;/p&gt;
&lt;p&gt;Other things to explore in this topic:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Localized tone mapping. In this post, we’ve used a single exposure value to map the entire image, but human eyes are a bit more complex than that. &lt;a href=&quot;https://bartwronski.com/2016/08/29/localized-tonemapping/&quot;&gt;Bart Wronski&lt;/a&gt; has a good post that goes in depth into what limitations you’ll encounter with a global tone mapping operator.&lt;/li&gt;
&lt;li&gt;Technically, we are calculating our exposure using scene-referred luminance after we’ve multiplied it by the albedo of our materials. It would be more technically correct to use the luminance pre-albedo, but that would require an additional framebuffer of just those values, and my understanding is that this technique is largely avoided.&lt;/li&gt;
&lt;li&gt;We applied our exposure after already rendering our scene in linear HDR space, but this means that your HDR buffer must have enough range to handle your highest radiance values. This can be tough with a RGBA16F buffer, as the max value is 65,504. Instead of dealing with the potential of “infinite” radiance being captured in the HDR buffer, &lt;a href=&quot;https://media.contentapi.ea.com/content/dam/eacom/frostbite/files/course-notes-moving-frostbite-to-pbr-v2.pdf&quot;&gt;Lagard and de Rousiers, 2014&lt;/a&gt; and others “pre-expose” their lights based off the last frames’ luminance.&lt;/li&gt;
&lt;li&gt;This post is specifically for rendering to SDR displays. HDR displays use different encodings, and there is no industry standard quite yet, but it means the workflow is slightly different. &lt;a href=&quot;https://knarkowicz.wordpress.com/2016/08/31/hdr-display-first-steps/&quot;&gt;Krzysztof Narkowicz&lt;/a&gt; has a blog post explaining first steps to supporting HDR along with some additional resources on the subject.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Also, if you read the last post, you may recall that I presented the following image as output from my toy physically based renderer, &lt;strong&gt;without&lt;/strong&gt; tone mapping:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5d5c2910ea18b345221658376cd64d19/ae828/beforeTonemapping.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvElEQVQoz2NgYGD4TwgzMzMDMdN/YtQyEKmIFExYUXJy8v+sjGAon5E8AxkZIRqVlFX+v37x+P+bxxP+qygJQuUoMFBLXeH/qiWT/2+YGPpfTY4CA2GYiZnhv7Wp+n9bdVHKw5CZCRKzxvqq/50tNaAxzkRZGLp5u/5f05nwf2lp4H9peUkUOZIMZIK6bvLE1v9fX5z9//ra/v+Te4pQ5EgPQ2DgS/Hz/lcSE/kvLSL8301V+D8POxN9EzYA6i33566PU7IAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Renderer output without tone mapping&quot;
        title=&quot;&quot;
        src=&quot;/static/5d5c2910ea18b345221658376cd64d19/44427/beforeTonemapping.png&quot;
        srcset=&quot;/static/5d5c2910ea18b345221658376cd64d19/d7a70/beforeTonemapping.png 180w,
/static/5d5c2910ea18b345221658376cd64d19/0b140/beforeTonemapping.png 360w,
/static/5d5c2910ea18b345221658376cd64d19/44427/beforeTonemapping.png 720w,
/static/5d5c2910ea18b345221658376cd64d19/fff27/beforeTonemapping.png 1080w,
/static/5d5c2910ea18b345221658376cd64d19/ae828/beforeTonemapping.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Note that this image lacks Gamma correction so it looks especially bad, but most of the damage is done by having the luminance values outside of the acceptable [0, 1] range. It is technically physically correct, but our display doesn’t care. Here is the same scene with tone mapping applied using the modified Reinhard curve:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/16337fd563a321d40b9263946ce992da/ae828/afterReinhard2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAm0lEQVQoz2NgYGD4TwgzMjL+ZyRCHRQTrZB6BuqpK/9XkhCkjoF8vNz/U+N8//uZK/znZmem3EAeTrb/uhoK/zVlBahjIAhzAw3lYWeh3MuwmOXj5vwvyM2BIka2C+XEhP6byQr/15IS/M/LwUq+C2Eu8dJV+F9gr/E/xVLlv52yKDGuxG8jJxsLMDJY/3OxMv8XAkYKMyOdEzYAJ9vjbiwmzHgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Renderer output with tone mapping&quot;
        title=&quot;&quot;
        src=&quot;/static/16337fd563a321d40b9263946ce992da/44427/afterReinhard2.png&quot;
        srcset=&quot;/static/16337fd563a321d40b9263946ce992da/d7a70/afterReinhard2.png 180w,
/static/16337fd563a321d40b9263946ce992da/0b140/afterReinhard2.png 360w,
/static/16337fd563a321d40b9263946ce992da/44427/afterReinhard2.png 720w,
/static/16337fd563a321d40b9263946ce992da/fff27/afterReinhard2.png 1080w,
/static/16337fd563a321d40b9263946ce992da/ae828/afterReinhard2.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Hopefully the stark difference demonstrates the need for tone mapping if you are attempting to implement PBR shading &lt;em&gt;with actual physical values&lt;/em&gt; for your lights. Unlike the images above, where we could still make sense of the blown out highlights, here it’s just impossible to get a proper image without abandoning physically meaningful lighting.&lt;/p&gt;
&lt;h2&gt;Code Sample&lt;/h2&gt;
&lt;p&gt;The images of the bunny were created using a BGFX-style example that you can find &lt;a href=&quot;https://github.com/BruOp/bgfx/tree/tonemapping/examples/41-tonemapping&quot;&gt;here&lt;/a&gt;. It includes the set up of the scene and GPU resources as well as the shaders that we’ve already gone over.&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;p&gt;While I’ve tried to diligently link to my references, I also have a general collection of links on tone mapping &lt;a href=&quot;https://github.com/BruOp/3d_programming_references#tone-mapping&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Automatic Exposure using a Luminance Histogram]]></title><description><![CDATA[This is part one of two on tone mapping. The other part can be found  here Introduction Recently, I’ve been building a small renderer using…]]></description><link>https://bruop.github.com//exposure/</link><guid isPermaLink="false">https://bruop.github.com//exposure/</guid><pubDate>Fri, 19 Apr 2019 12:00:14 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;This is part one of two on tone mapping. The other part can be found &lt;a href=&quot;/tonemapping&quot;&gt;here&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Recently, I’ve been building a small renderer using the cross-platform rendering library &lt;a href=&quot;https://github.com/bkaradzic/bgfx&quot;&gt;bgfx&lt;/a&gt; as a learning exercise. It loads &lt;a href=&quot;https://github.com/KhronosGroup/glTF-Sample-Models&quot;&gt;glTF&lt;/a&gt; models, shading them using the Cook-Torrance model described in the &lt;a href=&quot;https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md&quot;&gt;glTF specification&lt;/a&gt;. The implementation is incomplete and it renders the material using only punctual lights. It’s a single vertex + fragment shader. I loaded up the &lt;code class=&quot;language-text&quot;&gt;FlightHelmet&lt;/code&gt; model, added two lights on each side, started up my program and saw this:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5d5c2910ea18b345221658376cd64d19/ae828/beforeTonemapping.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvElEQVQoz2NgYGD4TwgzMzMDMdN/YtQyEKmIFExYUXJy8v+sjGAon5E8AxkZIRqVlFX+v37x+P+bxxP+qygJQuUoMFBLXeH/qiWT/2+YGPpfTY4CA2GYiZnhv7Wp+n9bdVHKw5CZCRKzxvqq/50tNaAxzkRZGLp5u/5f05nwf2lp4H9peUkUOZIMZIK6bvLE1v9fX5z9//ra/v+Te4pQ5EgPQ2DgS/Hz/lcSE/kvLSL8301V+D8POxN9EzYA6i33566PU7IAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Renderer output without tone mapping&quot;
        title=&quot;&quot;
        src=&quot;/static/5d5c2910ea18b345221658376cd64d19/44427/beforeTonemapping.png&quot;
        srcset=&quot;/static/5d5c2910ea18b345221658376cd64d19/d7a70/beforeTonemapping.png 180w,
/static/5d5c2910ea18b345221658376cd64d19/0b140/beforeTonemapping.png 360w,
/static/5d5c2910ea18b345221658376cd64d19/44427/beforeTonemapping.png 720w,
/static/5d5c2910ea18b345221658376cd64d19/fff27/beforeTonemapping.png 1080w,
/static/5d5c2910ea18b345221658376cd64d19/ae828/beforeTonemapping.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;You can see that the lit areas are basically just the color of the light sources, with ugly, uniform splotches removing all of the detail we’d expect to get from the normal maps and albedo textures. This is not unexpected. It may not be obvious why this isn’t a bug and why we’d expect our fragment shader to produce such an ugly image, so let me quickly explain.&lt;/p&gt;
&lt;p&gt;What we want in the end is this:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/16337fd563a321d40b9263946ce992da/ae828/afterReinhard2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAm0lEQVQoz2NgYGD4TwgzMjL+ZyRCHRQTrZB6BuqpK/9XkhCkjoF8vNz/U+N8//uZK/znZmem3EAeTrb/uhoK/zVlBahjIAhzAw3lYWeh3MuwmOXj5vwvyM2BIka2C+XEhP6byQr/15IS/M/LwUq+C2Eu8dJV+F9gr/E/xVLlv52yKDGuxG8jJxsLMDJY/3OxMv8XAkYKMyOdEzYAJ9vjbiwmzHgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Renderer output with tone mapping&quot;
        title=&quot;&quot;
        src=&quot;/static/16337fd563a321d40b9263946ce992da/44427/afterReinhard2.png&quot;
        srcset=&quot;/static/16337fd563a321d40b9263946ce992da/d7a70/afterReinhard2.png 180w,
/static/16337fd563a321d40b9263946ce992da/0b140/afterReinhard2.png 360w,
/static/16337fd563a321d40b9263946ce992da/44427/afterReinhard2.png 720w,
/static/16337fd563a321d40b9263946ce992da/fff27/afterReinhard2.png 1080w,
/static/16337fd563a321d40b9263946ce992da/ae828/afterReinhard2.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;Physically Based Lighting&lt;/h3&gt;
&lt;p&gt;In physically based rendering, objects are rendered using &lt;em&gt;physically based units&lt;/em&gt; from the fields of &lt;a href=&quot;https://en.wikipedia.org/wiki/Radiometry&quot;&gt;Radiometry&lt;/a&gt; and &lt;a href=&quot;https://en.wikipedia.org/wiki/Photometry_(optics)&quot;&gt;Photometry&lt;/a&gt;. The &lt;a href=&quot;https://en.wikipedia.org/wiki/Rendering_equation&quot;&gt;rendering equation&lt;/a&gt; is meant to produce the &lt;a href=&quot;https://en.wikipedia.org/wiki/Radiance&quot;&gt;radiance&lt;/a&gt; for each pixel. In my example, the lights are using the photometric unit of &lt;a href=&quot;https://en.wikipedia.org/wiki/Lumen_(unit)&quot;&gt;lumens&lt;/a&gt;, and both are set to emit 800 lm, but it could be much higher. The sun, a directional light, illuminates the earth’s surface with ~120,000 &lt;a href=&quot;https://en.wikipedia.org/wiki/Lux&quot;&gt;lux&lt;/a&gt;. This means that when we solve the rendering equation for these objects, we’re going to end up with values that are effectively unbounded and we may end up with radiance values that differ by several orders of magnitude in the same frame. Additionally, all of our calculations are taking place in linear space — that is to say, that an RGB value corresponding to (1.0, 1.0, 1.0) corresponds to half as much radiance as a value of (2.0, 2.0, 2.0).&lt;/p&gt;
&lt;p&gt;This is a problem however, because (most) of our displays work differently. Standard definition displays expects our frame buffer to contain RGB values in the &lt;a href=&quot;https://en.wikipedia.org/wiki/SRGB&quot;&gt;sRGB color space&lt;/a&gt; that are between 0 and 1, with (1.0, 1.0, 1.0) corresponding to white.&lt;sup&gt;&lt;a href=&quot;#note_1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; So any RGB that our fragment shader produces are clamped to [0, 1] when they are written to the 32-bit back buffer. So we end up with clipped colors, and everything ends up being basically white!&lt;/p&gt;
&lt;h2&gt;Tone Mapping&lt;/h2&gt;
&lt;p&gt;The solution then, is to take our physical, unbounded HDR values and map them first to a LDR linear space [0, 1], and then finally apply &lt;a href=&quot;http://blog.johnnovak.net/2016/09/21/what-every-coder-should-know-about-gamma/&quot;&gt;gamma correction&lt;/a&gt; to produce the sRGB value our displays expect. Here’s a diagram that describes the most basic tone mapping pipeline:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ecff7f0a2babbe9a75e20c835f538967/1d510/tonemapping_pipeline.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 27.67762460233298%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABg0lEQVQY02NggALl7ouMDOm7WBmQAEvJPkGGtB3yDBEb5RjCNkozZO9SZMjcxY1QEcTIVb4fRQ/D////xd6/eSnM4NnNZN6+m+P+46eiX37/lzh7/a4IRP4V5///f0X+//8BxA+Zt+7dx3L9/hPxhy/fSZy7dkuAIWIFq3r7RjaFqcfEpaeeEGN49uzZr9evX98CaT5x7aH8u3dvnwH5/z9++HACJPby5auOz1++/H///v3fx4+fet27e0/n06dPX75+/fr/1es3K0BqVCcfttBcdvuP9sp7XxgePXr0/927dx8Yghk4V1zYYfDy5Yu/QEtABtwFqmV8+vrZvJ8/fv7/8ePH/wcvHkTuu7LP7j8UvH//dg/IQO/Z67yMdn/9b7nrw3+GP3/+3P369ctBkObtZy7JAdmn//79++jLly8bQYrff3hfCVTz+NevX/efPX/mfO3mNU2g4TdAat5/+DAVpEZ/2n5j9WV37qqvuH8NHpYcVU+YGDyWMjOQCmpvoEQKAAji42NUwhc/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Tone mapping pipeline&quot;
        title=&quot;&quot;
        src=&quot;/static/ecff7f0a2babbe9a75e20c835f538967/44427/tonemapping_pipeline.png&quot;
        srcset=&quot;/static/ecff7f0a2babbe9a75e20c835f538967/d7a70/tonemapping_pipeline.png 180w,
/static/ecff7f0a2babbe9a75e20c835f538967/0b140/tonemapping_pipeline.png 360w,
/static/ecff7f0a2babbe9a75e20c835f538967/44427/tonemapping_pipeline.png 720w,
/static/ecff7f0a2babbe9a75e20c835f538967/1d510/tonemapping_pipeline.png 943w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;The pipeline has 5 stages:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Render your scene into a framebuffer that supports HDR values i.e. a floating point buffer with 16-bits or 32-bits per channel. Which one you choose is (as always) a tradeoff between precision, range and memory, but for my scene I’m going to go with a RGBA16F framebuffer. Make sure your output is in linear space.&lt;/li&gt;
&lt;li&gt;Using either mip mapping or compute shaders, find the average scene luminance using the HDR color buffer.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;In a separate render pass, produce a linear, clamped color buffer by:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Scaling the input using the average scene luminance to obtain a “calibrated” RGB value&lt;/li&gt;
&lt;li&gt;Scaling the calibrated value using a Tone Curve, inputting either the RGB or the luminance value of the fragment&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Transform your linear clamped value using the inverse electrical optical transfer function (EOTF).&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;With typical, non-HDR displays, we’re basically transforming our linear color into sRGB color space by applying the inverse gamma transformation&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Write this non-linear result to the back buffer, which is presented to the user.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In the figure, the green arrows indicate that the inputs/outputs are in linear space, while the orange arrow is in gamma space.&lt;/p&gt;
&lt;p&gt;In the rest of this post, I’m going to tackle the second step of finding the average luminance value, and how we can use it to scale the input luminance. The third step is tackled in &lt;a href=&quot;/tonemapping&quot;&gt;the next post which is specifically on tone operators&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;So first, let’s explain the process of scaling the input luminance using Exposure.&lt;/p&gt;
&lt;h3&gt;Exposure&lt;/h3&gt;
&lt;p&gt;When a human eye views a scene, it will naturally dilate to adjust to the amount of light reaching it. Similarly, photographers have several ways to control the amount of light reaching the sensors, such as the aperture size (f-stop) and shutter speed. In photography, these controls correspond to the &lt;a href=&quot;https://en.wikipedia.org/wiki/Exposure_value&quot;&gt;exposure value&lt;/a&gt;, or &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;EV&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05764em;&quot;&gt;E&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.22222em;&quot;&gt;V&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;, which is a logarithmic representation of the luminance. Increasing the &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;EV&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05764em;&quot;&gt;E&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.22222em;&quot;&gt;V&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; by a value of +1 results in a doubling of the luminance.&lt;/p&gt;
&lt;p&gt;In our context, the exposure linearly scales our the scene luminance to simulate how much light is actually hitting the sensor. The reason we do this is to bring our input scene into the domain where our tone operators will scale the final values the way we expect. It took me a while to understand how this works compared to a camera, but it’s actually basically the same idea. With a physical camera, the amount of photons hitting the sensors needs to be controlled such that we are able to resolve features, avoiding having too much or too little light.&lt;/p&gt;
&lt;p&gt;It’s up to us to actually provide the exposure value, but in order to avoid having it set by the user/artist, we’re going to use the average scene luminance to derived from our HDR buffer to calculate the exposure.&lt;/p&gt;
&lt;p&gt;There are actually quite a few different ways to calculate exposure from average scene luminance, many of which are explained in this excellent post by &lt;a href=&quot;https://knarkowicz.wordpress.com/2016/01/09/automatic-exposure/&quot;&gt;Krzysztof Narkowicz&lt;/a&gt;. For this post, I’m going to use the method described in &lt;a href=&quot;https://media.contentapi.ea.com/content/dam/eacom/frostbite/files/course-notes-moving-frostbite-to-pbr-v2.pdf&quot;&gt;Lagard and de Rousiers, 2014&lt;/a&gt; (pg. 85). Basically, we can calculate the luminance value that will saturate the sensor, &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;max&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{\text{max}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.151392em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;max&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;, then use that to scale our scene luminance:&lt;/p&gt;
&lt;span class=&quot;katex-display&quot;&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;100&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;⁡&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo fence=&quot;true&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;avg&lt;/mtext&gt;&lt;/msub&gt;&lt;mfrac&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mfrac&gt;&lt;mo fence=&quot;true&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;EV_{100} = \log_{2} \left(L_{\text{avg}} \frac{S}{K} \right)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05764em;&quot;&gt;E&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.22222em;&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.30110799999999993em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord mtight&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mord mtight&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.40003em;vertical-align:-0.95003em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mop&quot;&gt;&lt;span class=&quot;mop&quot;&gt;lo&lt;span style=&quot;margin-right:0.01389em;&quot;&gt;g&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.20696799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.4558600000000004em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.24414em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.16666666666666666em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;minner&quot;&gt;&lt;span class=&quot;mopen delimcenter&quot; style=&quot;top:0em;&quot;&gt;&lt;span class=&quot;delimsizing size3&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15139200000000003em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;avg&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.286108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.36033em;&quot;&gt;&lt;span style=&quot;top:-2.314em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.07153em;&quot;&gt;K&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05764em;&quot;&gt;S&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.686em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose delimcenter&quot; style=&quot;top:0em;&quot;&gt;&lt;span class=&quot;delimsizing size3&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;katex-display&quot;&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;max&lt;/mtext&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;78&lt;/mn&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;×&lt;/mo&gt;&lt;msup&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;100&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mspace linebreak=&quot;newline&quot;&gt;&lt;/mspace&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{\text{max}} = \frac{78}{qS} \times 2^{EV_{100}} \\&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.151392em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;max&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.20188em;vertical-align:-0.8804400000000001em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.32144em;&quot;&gt;&lt;span style=&quot;top:-2.314em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.03588em;&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05764em;&quot;&gt;S&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;8&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.8804400000000001em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;×&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.8913309999999999em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.8913309999999999em;&quot;&gt;&lt;span style=&quot;top:-3.113em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.05764em;&quot;&gt;E&lt;/span&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.22222em;&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.31731428571428577em;&quot;&gt;&lt;span style=&quot;top:-2.357em;margin-left:-0.22222em;margin-right:0.07142857142857144em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.5em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size3 size1 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord mtight&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mord mtight&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.143em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace newline&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;katex-display&quot;&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mtext&gt;H&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;max&lt;/mtext&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mspace linebreak=&quot;newline&quot;&gt;&lt;/mspace&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;\text{H} = \frac{1}{L_{\text{max}}} \\&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord text&quot;&gt;&lt;span class=&quot;mord&quot;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.1574400000000002em;vertical-align:-0.8360000000000001em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.32144em;&quot;&gt;&lt;span style=&quot;top:-2.3139999999999996em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.151392em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;max&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.8360000000000001em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace newline&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;p&gt;Where &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;S&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05764em;&quot;&gt;S&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; is the Sensor sensitivity, &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;K&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.07153em;&quot;&gt;K&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; is the reflected-light meter calibration constant, &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;q&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.625em;vertical-align:-0.19444em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.03588em;&quot;&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; is the lens and vignetting attentuation, &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;H&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.08125em;&quot;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; is the exposure and &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;avg&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{\text{avg}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.969438em;vertical-align:-0.286108em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15139200000000003em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;avg&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.286108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; is the average scene luminance.&lt;/p&gt;
&lt;p&gt;If we were fully modelling a physical camera, we might need to use different &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;S&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05764em;&quot;&gt;S&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; values to offset the loss of light when changing the aperture size, which also effects the depth of field. But since we aren’t worrying about that, we’ll use &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;100&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;S=100&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05764em;&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.64444em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;. Meanwhile, it seems that Canon, Nikon and Sekonic all use &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;12.5&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;K = 12.5&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.07153em;&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.64444em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;5&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; and it seems most rendering engines follow suit. Finally, &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.65&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;q=0.65&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.625em;vertical-align:-0.19444em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.03588em;&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.64444em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;5&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; appears similarly ubiquitous. If you want to know a bit more about what these quantities actually represent, the previously referenced &lt;a href=&quot;https://media.contentapi.ea.com/content/dam/eacom/frostbite/files/course-notes-moving-frostbite-to-pbr-v2.pdf&quot;&gt;Lagard and de Rousiers, 2014&lt;/a&gt; has more detail, as does the &lt;a href=&quot;https://google.github.io/filament/Filament.html#physicallybasedcamera&quot;&gt;Filament&lt;/a&gt; documentation.&lt;/p&gt;
&lt;p&gt;Simplifying our equations a bit and plugging in the numbers, We can now rewrite our previous equation for &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;max&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{\text{max}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.151392em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;max&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; more simply:&lt;/p&gt;
&lt;span class=&quot;katex-display&quot;&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;max&lt;/mtext&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;9.6&lt;/mn&gt;&lt;mo&gt;×&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;avg&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{\text{max}} = 9.6 \times L_{\text{avg}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.151392em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;max&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.72777em;vertical-align:-0.08333em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;×&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.969438em;vertical-align:-0.286108em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15139200000000003em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;avg&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.286108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;p&gt;Our final scaled color is then simply:&lt;/p&gt;
&lt;span class=&quot;katex-display&quot;&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msubsup&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo mathvariant=&quot;normal&quot;&gt;′&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;H&lt;/mtext&gt;&lt;mo&gt;×&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;max&lt;/mtext&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mn&gt;9.6&lt;/mn&gt;&lt;mo&gt;×&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mtext&gt;avg&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;c_{rgb}^\prime = \text{H} \times c_{rgb} = \frac{c_{rgb}}{L_{\text{max}}} = \frac{c_{rgb}}{9.6 \times L_{\text{avg}}}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:1.185em;vertical-align:-0.383108em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.801892em;&quot;&gt;&lt;span style=&quot;top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.02778em;&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.03588em;&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;b&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.1130000000000004em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.383108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.76666em;vertical-align:-0.08333em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord text&quot;&gt;&lt;span class=&quot;mord&quot;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;×&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.716668em;vertical-align:-0.286108em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.3361079999999999em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.02778em;&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.03588em;&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;b&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.286108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:1.94356em;vertical-align:-0.8360000000000001em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.1075599999999999em;&quot;&gt;&lt;span style=&quot;top:-2.3139999999999996em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.151392em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;max&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.3361079999999999em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.02778em;&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.03588em;&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;b&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.286108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.8360000000000001em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.079668em;vertical-align:-0.972108em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.1075599999999999em;&quot;&gt;&lt;span style=&quot;top:-2.314em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;×&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15139200000000003em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord text mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;avg&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.286108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.3361079999999999em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.02778em;&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.03588em;&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;b&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.286108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.972108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;p&gt;Note that this value is still not clamped to [0, 1], and so we will still potentially get a lot of clipping.&lt;/p&gt;
&lt;p&gt;Additionally, we haven’t discussed how to actually calculated the average luminance. There are two popular ways to do so:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Use a geometric average, obtained by repeatedly downsampling the luminance of our HDR image (similar to a mip map chain).&lt;/li&gt;
&lt;li&gt;Create a histogram of some static luminance range.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The geometric average is susceptible to extreme values being over-represented in the final luminance value, so instead we’re going to construct the histogram. This allows us more control (if we desire it) over how extreme values influence our “average” — with a histogram, we can choose to use other features, like the median, if we wanted to. For now, we’ll stick with the average.&lt;/p&gt;
&lt;h3&gt;Constructing the Luminence Histogram&lt;/h3&gt;
&lt;p&gt;To construct the histogram, I used &lt;a href=&quot;http://www.alextardif.com/HistogramLuminance.html&quot;&gt;Alex Tardif’s&lt;/a&gt; blog post on the exact same subject as a reference. I’ll still explain the code here, and try to focus on the parts that confused me the most while trying to replicate Tardif’s method. Here’s the compute shader, written using BGFX’s version of glsl:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;glsl&quot;&gt;&lt;pre class=&quot;language-glsl&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// This defines all the preprocessor definitions that translate things&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// like gl_LocalInvocationIndex to HLSL&apos;s SV_GroupIndex&lt;/span&gt;
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#&lt;/span&gt;include &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;bgfx_compute&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sh&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; GROUP_SIZE &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; THREADS_X &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; THREADS_Y &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;

&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; EPSILON &lt;span class=&quot;token number&quot;&gt;0.005&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// Taken from RTR vol 4 pg. 278&lt;/span&gt;
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; RGB_TO_LUM &lt;span class=&quot;token keyword&quot;&gt;vec3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.2125&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.7154&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0721&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Uniforms:&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;uniform&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;vec4&lt;/span&gt; u_params&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// u_params.x = minimum log_2 luminance&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// u_params.y = inverse of the log_2 luminance range&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Our two inputs, the read-only HDR color image, and the histogramBuffer&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;IMAGE2D_RO&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_texColor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rgba16f&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;BUFFER_RW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;histogram&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Shared histogram buffer used for storing intermediate sums for each work group&lt;/span&gt;
SHARED &lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt; histogramShared&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;GROUP_SIZE&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;


&lt;span class=&quot;token comment&quot;&gt;// For a given color and luminance range, return the histogram bin index&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;colorToBin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;vec3&lt;/span&gt; hdrColor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; minLogLum&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; inverseLogLumRange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Convert our RGB value to Luminance, see note for RGB_TO_LUM macro above&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; lum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hdrColor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; RGB_TO_LUM&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Avoid taking the log of zero&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lum &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; EPSILON&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Calculate the log_2 luminance and express it as a value in [0.0, 1.0]&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// where 0.0 represents the minimum luminance, and 1.0 represents the max.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; logLum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;clamp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; minLogLum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; inverseLogLumRange&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Map [0, 1] to [1, 255]. The zeroth bin is handled by the epsilon check above.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;logLum &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;254.0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 16 * 16 * 1 threads per group&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;NUM_THREADS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;THREADS_X&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; THREADS_Y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Initialize the bin for this thread to 0&lt;/span&gt;
  histogramShared&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;gl_LocalInvocationIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;groupMemoryBarrier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;uvec2&lt;/span&gt; dim &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;imageSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_texColor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xy&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Ignore threads that map to areas beyond the bounds of our HDR image&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;gl_GlobalInvocationID&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; dim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; gl_GlobalInvocationID&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; dim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;vec3&lt;/span&gt; hdrColor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;imageLoad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_texColor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ivec2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;gl_GlobalInvocationID&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xy&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xyz&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt; binIndex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;colorToBin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hdrColor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; u_params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; u_params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// We use an atomic add to ensure we don&apos;t write to the same bin in our&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// histogram from two different threads at the same time.&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;atomicAdd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;histogramShared&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;binIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Wait for all threads in the work group to reach this point before adding our&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// local histogram to the global one&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;groupMemoryBarrier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Technically there&apos;s no chance that two threads write to the same bin here,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// but different work groups might! So we still need the atomic add.&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;atomicAdd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;histogram&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;gl_LocalInvocationIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; histogramShared&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;gl_LocalInvocationIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This compute shader creates work groups of 256 threads (&lt;code class=&quot;language-text&quot;&gt;NUM_THREADS&lt;/code&gt;) that operate on 16 * 16 pixel chunks of our HDR input image. Each thread then operates on one pixel, assigning it a bin index for our histogram using its luminance value (&lt;code class=&quot;language-text&quot;&gt;colorToBin&lt;/code&gt;), increasing the count in the bin by one. The &lt;code class=&quot;language-text&quot;&gt;NUM_THREADS&lt;/code&gt; are chosen such that the &lt;code class=&quot;language-text&quot;&gt;gl_LocalInvocationIndex&lt;/code&gt; maps from 0 - 255 (since &lt;code class=&quot;language-text&quot;&gt;16*16\*1 == 255&lt;/code&gt;), which is convenient for reasoning about how we access our histogram buffer, which has 256 bins. The figure below may help you visualize how the global work groups and individual invocations work to process the image:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/82d94f7846e292d4170f781d671d9506/d446b/grid_diagram.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 67.07021791767555%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADmUlEQVQ4y12TaUyUZxSFvz/92X9NzbBYGlJrKyAq0GEbtsIMSAdBFp1hUBl2ATuO0opFDAkm4FJEsAanlTU4rFqqrcXUskgXbJFFy9IUFUpkZsBCkUUCTz9o2jQ9yclN3uS9Offec4SZWROWqRkayj8hT6fmdI6WB/0/8efzBfF9iknLNCbzGL8O9dB19y6jo6OYzWYmJiZYXV1lDWv1Hwpn87XUV5dRcOIQyWoZuv3BlJacpLw2n7prxdxpb+Re99f09XTx5MljZmZmMJlMTE9P/1v/C8HPyY4Ar40kaOUoFc6oI2Rc+DgbT5k1BflZVF4pwnD5DBVVF6g1XubRo1Gx6SxTonqLxcLs7CzLy8ssLS2xsrKC4K/cTKDSicBwB1R7vNElRZFzMI4jmUpqqktpNNZQVVXKZ5VF1DYYePHi749DQ0MMDg4yPDzMyMgIAwMD680Fn53OBCmlhOySok+JoLOtldyjOuS+m6i/WkZPVwe3b9TTVFdBY0OVqMzM/PwCD38ZpL9/gN6+Pnp67jM2Nsbi4iKCPGgb8jAnFIot6BNjePhjBz80VxKucMVYdZ57ndf4ttVIx+0v+Kqlnq6ONpqvVnBSn8iHGckitVwqOkWTsZrHo78heLxrh4u3NbGxcvKO7SM3cScNZ/RcKjzOpXO5tDRd4db1Gr5sqaO97ea6AwwlheS9H098TACRYTLe89tKVnocz6anEBylEuwdXsZf/hbKCAci1a6kpviSFu9H+O5txCWHclE8SsvNZv4Qd/TguzsYzuVx4/PrpKoCOJToQUy0C/tDvTBPTiC4+VihiLDGTfYqW91eISrGi6QEPzIzZYTtcibtyF7RQiW0d7by1DTJ99/couRUNsUFuYSJytIPeBIdu4MPMvdgMf2OoNHak5D6hmgTK7a7Skg6ECruRyVa6G0CQxxJObwXQ8V5un/uYmx8nLraMjS7ZehTpexwkpChDeGj4wqOpst5NjWJoIq0R62xIyjEjnc8bJB6SAgO3IST4wYCgrdwUKfi0/Ji7vd1ryfn7OkcPLe/hlK+mQ22L4nHc0Ad/SZR0W48XRtZ5i7B3dMKLx8bZAEi3V/H01OkzAZ5oBOHszRU114U7dHNgmgLY6WBrIxY0lNVaPdFoddpKCxI49iJNDGO4wjO4phSF1u8RHU+vhvxcrXF398Obz8JQcEO6LI1VFYV09vbzfP5Oebm5tbSy/+xuLC4npa/ANRouDu0DFRDAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Diagram of compute space mapping to image space&quot;
        title=&quot;&quot;
        src=&quot;/static/82d94f7846e292d4170f781d671d9506/44427/grid_diagram.png&quot;
        srcset=&quot;/static/82d94f7846e292d4170f781d671d9506/d7a70/grid_diagram.png 180w,
/static/82d94f7846e292d4170f781d671d9506/0b140/grid_diagram.png 360w,
/static/82d94f7846e292d4170f781d671d9506/44427/grid_diagram.png 720w,
/static/82d94f7846e292d4170f781d671d9506/d446b/grid_diagram.png 826w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Each work group has a shared buffer, &lt;code class=&quot;language-text&quot;&gt;histogramShared&lt;/code&gt;, to store the counts only for the chunk of pixels it is operating over, but then the local results are added into our global &lt;code class=&quot;language-text&quot;&gt;histogram&lt;/code&gt; buffer at the end of the invocation. This allows us to avoid locking the global buffer for every pixel we operate on.&lt;/p&gt;
&lt;p&gt;It’s also important to note that we use the shared buffer &lt;code class=&quot;language-text&quot;&gt;histogramShared&lt;/code&gt; to store the intermediate results for each work group, and then aggregate the results into the global &lt;code class=&quot;language-text&quot;&gt;histogram&lt;/code&gt; buffer only at the end of each invocation.&lt;/p&gt;
&lt;p&gt;After dispatching the compute shader with a work group size large enough to cover the entire image, the input buffer will now be filled with the histogram data.&lt;/p&gt;
&lt;h3&gt;Calculating the Average&lt;/h3&gt;
&lt;p&gt;With the luminance buffer now in hand, we can our average. Since the buffer purely exists on the GPU, we can use another compute shader to find the average. This time, we’re not mapping our compute space to a 2D image, but to our 1D histogram buffer instead. Additionally, instead of writing to the buffer, we’ll be reading from the buffer and storing our value into a single-pixel R16F texture. So things will be a bit simpler than in the last program. Once again following &lt;a href=&quot;http://www.alextardif.com/HistogramLuminance.html&quot;&gt;Alex Tardif’s lead&lt;/a&gt;, the compute shader is show below.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;glsl&quot;&gt;&lt;pre class=&quot;language-glsl&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;&lt;span class=&quot;token preprocessor builtin&quot;&gt;#&lt;/span&gt;include &lt;span class=&quot;token string&quot;&gt;&quot;bgfx_compute.sh&quot;&lt;/span&gt;

&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; GROUP_SIZE &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; THREADS_X &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; THREADS_Y &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Uniforms:&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;uniform&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;vec4&lt;/span&gt; u_params&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; minLogLum u_params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; logLumRange u_params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; timeCoeff u_params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;z
&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; numPixels u_params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;w

&lt;span class=&quot;token preprocessor builtin&quot;&gt;#define&lt;/span&gt; localIndex gl_LocalInvocationIndex

&lt;span class=&quot;token comment&quot;&gt;// We&apos;ll be writing our average to s_target&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;IMAGE2D_RW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; r16f&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;BUFFER_RW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;histogram&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Shared&lt;/span&gt;
SHARED &lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt; histogramShared&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;GROUP_SIZE&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;NUM_THREADS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;THREADS_X&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; THREADS_Y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Get the count from the histogram buffer&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt; countForThisBin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; histogram&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;localIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  histogramShared&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;localIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; countForThisBin &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; localIndex&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;groupMemoryBarrier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Reset the count stored in the buffer in anticipation of the next pass&lt;/span&gt;
  histogram&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;localIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// This loop will perform a weighted count of the luminance range&lt;/span&gt;
  UNROLL
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt; cutoff &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;GROUP_SIZE &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; cutoff &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; cutoff &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;uint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;localIndex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; cutoff&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      histogramShared&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;localIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; histogramShared&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;localIndex &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; cutoff&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;groupMemoryBarrier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// We only need to calculate this once, so only a single thread is needed.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;threadIndex &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Here we take our weighted sum and divide it by the number of pixels&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// that had luminance greater than zero (since the index == 0, we can&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// use countForThisBin to find the number of black pixels)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; weightedLogAverage &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;histogramShared&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;numPixels &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;countForThisBin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Map from our histogram space to actual luminance&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; weightedAvgLum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;exp2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;weightedLogAverage &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;254.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; logLumRange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; minLogLum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// The new stored value will be interpolated using the last frames value&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// to prevent sudden shifts in the exposure.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; lumLastFrame &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;imageLoad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ivec2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; adaptedLum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; lumLastFrame &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;weightedAvgLum &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; lumLastFrame&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; timeCoeff&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;imageStore&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s_target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ivec2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;vec4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;adaptedLum&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For each thread, we read in the histogram value and store it in a local variable. Then we use a shared buffer to store a weighted count. We also take this opportunity to reset the global histogram buffer so that it can be used in the next frame. Take note that we’ve aliased&lt;/p&gt;
&lt;p&gt;the biggest trick here is the loop that accumulates the count into a single element of our shared buffer. It’s a way of leveraging the parallel nature of our compute space to perform the sums over two cells at a time, with the separation between the two cells starting at &lt;code class=&quot;language-text&quot;&gt;cutoff = NUM_THREADS / 2&lt;/code&gt;, then being halved every iteration, until we end up with a distance of 0. The threads that have &lt;code class=&quot;language-text&quot;&gt;gl_LocalInvocationIndex &amp;gt; cutoff&lt;/code&gt; will be stalled, as they cannot contribute to the sum. The figure below illustrates the first few iterations for the thread with index &lt;code class=&quot;language-text&quot;&gt;i&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fc8a99e0682e1900d9e2613a0d08dc9b/ae828/avg_diagram.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 720px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 41.171875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABu0lEQVQoz5WRa2/SYBSA+dPG6AZ4wS0b/oE5/aL+Ap1ulF7AaIyJCwpsDiyWdkBHuZZSSrk9vi0z2VdP8uSc8+ZNzpNzEkEQMBqNGI/HOM6AVtsRtY83DfG8+R1Cpu6USacjsLfYNm67g3dzE7+Hvk9iMplgGE2WixmfvvzhQfqEZ9k8mQOJzKFMJquIXubR8yIv9t6S23nIh90UHwWnybQgxVn6Me/u3efi/QmJ1WpFGIasVkvGbkClalKuGFxcWrSuB7QtB9Ow0WsWlz8v0Mtl2rpOp9HAjcy63ZixsA1cd2toWdfMfJfiZ51U5oz9bI70ocqr/ddoT9JITzNIySS5oyPyxQKKqqJoGmqhEKMVi0iyTK1e3xouFguiGI18YScMyw2uflnUq3Vq5+c0yhU69d84rZbYpYcr9u0Km7tENwhms61hs2kSBB5fvxns7uV5efAGObXD6fExkjCQFSU2UjSVgsjaLaow/VdLkkStViOxXq9ZLpexoW0P+V4S+/txhVEqoVermKYpVmJhidzr9cQfm5Yw7ff7DIdDBoNBnKPej67MbWw2mzjP5z5Or8tcDIleooH/E38BV181GwAE3sQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Illustration of parallelized aggregation&quot;
        title=&quot;&quot;
        src=&quot;/static/fc8a99e0682e1900d9e2613a0d08dc9b/44427/avg_diagram.png&quot;
        srcset=&quot;/static/fc8a99e0682e1900d9e2613a0d08dc9b/d7a70/avg_diagram.png 180w,
/static/fc8a99e0682e1900d9e2613a0d08dc9b/0b140/avg_diagram.png 360w,
/static/fc8a99e0682e1900d9e2613a0d08dc9b/44427/avg_diagram.png 720w,
/static/fc8a99e0682e1900d9e2613a0d08dc9b/fff27/avg_diagram.png 1080w,
/static/fc8a99e0682e1900d9e2613a0d08dc9b/ae828/avg_diagram.png 1280w&quot;
        sizes=&quot;(max-width: 720px) 100vw, 720px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;In the diagram, the red regions of the buffer are summed with the blue regions and stored in the blue. In the next interation, the red regions become gray, indication that they are ignored for this (and all following) iterations. It’s important to note that since the buffer sizes and the compute size is the same, we are actually stalling the threads corresponding to the red and gray regions with &lt;code class=&quot;language-text&quot;&gt;if (uint(gl_LocalInvocationIndex) &amp;lt; cutoff)&lt;/code&gt; that can be seen in the code above. Only the blue regions are active. This may seem wasteful, but we’ll still get an aggregation in &lt;code class=&quot;language-text&quot;&gt;O(log_2(N))&lt;/code&gt; iterations instead of &lt;code class=&quot;language-text&quot;&gt;O(N)&lt;/code&gt;, so the speed up is considerable over the naive, single threaded approach.&lt;/p&gt;
&lt;p&gt;At the end of the loop, we now have our weighted sum, which we can easily use to find our final “average” value. To do so, we first divide our weighted count (stored in by the aggregation above &lt;code class=&quot;language-text&quot;&gt;histogramShared[0]&lt;/code&gt;) and divide it by the number of pixels that contribute &lt;em&gt;any&lt;/em&gt; luminance — we exclude the count that was stored in &lt;code class=&quot;language-text&quot;&gt;histogram[0]&lt;/code&gt; since those were the ones that fell below our threshold luminance value.&lt;/p&gt;
&lt;p&gt;Finally, we move from the histogram bin space back to actual luminance values by performing the inverse of the operation we performed when constructing the histogram. This gives us the actual average luminance value for this frame.&lt;/p&gt;
&lt;p&gt;However, to prevent sudden changes in the exposure which would cause the final image to “flicker” for the user, we are going to use the &lt;a href=&quot;https://google.github.io/filament/Filament.html#mjx-eqn-adaptation&quot;&gt;last frame’s exposure value&lt;/a&gt; to smoothly change the value we store in the image. That’s it! We now have our &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;L_{avg}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.969438em;vertical-align:-0.286108em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15139200000000003em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.03588em;&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.03588em;&quot;&gt;g&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.286108em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; value, which we can use with the equation above to calculate the exposure to prepare our image for tone mapping! Which is in the next blog post.&lt;/p&gt;
&lt;h2&gt;Code Sample&lt;/h2&gt;
&lt;p&gt;The images of the bunny were created using a BGFX-style example that you can find &lt;a href=&quot;https://github.com/BruOp/bgfx/tree/tonemapping/examples/41-tonemapping&quot;&gt;here&lt;/a&gt;. It includes the set up of the scene and GPU resources as well as the shaders that we’ve already gone over.&lt;/p&gt;
&lt;h2&gt;Notes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;This is not true for HDR displays. Those displays use other color spaces that &lt;a href=&quot;https://www.ea.com/frostbite/news/high-dynamic-range-color-grading-and-display-in-frostbite&quot;&gt;newer games are starting to support&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;p&gt;While I’ve tried to diligently link to my references, I also have a general collection of links on tone mapping &lt;a href=&quot;https://github.com/BruOp/3d_programming_references#tone-mapping&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;!-- I&apos;ve read about many different techniques in computer graphics on blogs, twitter and my copy of [Real Time Rendering](), but I&apos;ve rarely actually gone through and implemented any of them. My previous attempts to start had be --&gt;</content:encoded></item></channel></rss>